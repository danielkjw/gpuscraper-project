NEG.Module("Biz.Product.Compare2019", function (require) {var storage = require("Biz.Storage");var $ = require("NEG.ThirdParty.JQuery");var name = "Compare", name2019 = "Compare2019";var compare = function (options) {var me = arguments.callee;if (!(this instanceof me)) {return new me(options);}if (options && options.isSimilarModule) {options = NEG.merge({'inputSelector': '.combo-item-compare input','compareSubCateGroup': '#similarCompareListPopup .item-compare-list','compareGroup': '#similarCompareListPopup .item-compare-list','maxSelected': 5,'goCompare': null,'compare': "#similarCompareListPopup #gocompare2019",'edit': "#similarCompareListPopup #compare_edit",'cancel': "#similarCompareListPopup #compare_edit_cancel",'remove': "#similarCompareListPopup #compare_edit_remove",'popup': '#similarCompareListPopup',"removebutton": ".item-compare-remove","container": ".combo-item-compare","popupBody": "#similarCompareListPopup .popover-body","popupBodyMsg": "#similarCompareListPopup .popover-body .message","enableCompare2019": true,"maxSubCategoryGroup": 3,"enableRecommendation": true,"maxRecommendItems": 10}, options);} else {options = NEG.merge({'inputSelector': '.item-compare-box input','compareSubCateGroup': '#compareListPopup2019 .item-compare-list','compareGroup': '#compareListPopup2019 .item-compare-list','maxSelected': 5,'goCompare': null,'compare': "#compareListPopup2019 #gocompare2019",'edit': "#compareListPopup2019 #compare_edit",'cancel': "#compareListPopup2019 #compare_edit_cancel",'remove': "#compareListPopup2019 #compare_edit_remove",'popup': '#compareListPopup2019',"removebutton": ".item-compare-remove","container": ".item-compare-box","popupBody": "#compareListPopup2019 .popover-body","popupBodyMsg": "#compareListPopup2019 .popover-body .message","enableCompare2019": true,"maxSubCategoryGroup": 3,"enableRecommendation": true,"maxRecommendItems": 10}, options);}var init = function () {if (!options.enableCompare2019 || options.enableCompare2019 === false) {return;}$(options.inputSelector).unbind("click");if (!options.isSimilarModule) {$(options.container).unbind("mouseenter");$(options.container).unbind("mouseleave");}$(options.compare).unbind("click");$(options.edit).unbind("click");$(options.cancel).unbind("click");$(options.remove).unbind("click");$(options.popupBody).unbind("click");$(options.inputSelector).on("click", selectItem);if (!options.isSimilarModule) {$(options.container).on("mouseenter", showPopup);$(options.container).on("mouseleave", delayHidePopUp);}$(options.compare).on("click", goCompare);$(options.edit).on("click", edit);$(options.cancel).on("click", cancel);$(options.remove).on("click", removeSelected);$(options.popupBody).on("click", popBodyClick);tranferOldData();CorrectionMaxSubCate();if (Biz.Product.ComparePageConfig2019) {return;}rebuildItemHtml();};var CorrectionMaxSubCate = function () {var compareData2019 = api.getCompareData2019();if (Biz.Product.ComparePageConfig2019 && Biz.Product.ComparePageConfig2019.maxSubCategoryGroup) {var comparePageCount = Biz.Product.ComparePageConfig2019.maxSubCategoryGroup;if (comparePageCount && parseInt(comparePageCount)) {options.maxSubCategoryGroup = parseInt(comparePageCount);}}if (compareData2019 && compareData2019.length > 0 && compareData2019.length > options.maxSubCategoryGroup) {compareData2019 = $.grep(compareData2019, function (v, n) {return n <= options.maxSubCategoryGroup - 1;});api.setCompareData2019(compareData2019);}};var tranferOldData = function () {if (options.enableCompare2019 === true) {var compareData = api.getCompareData();var compareData2019 = api.getCompareData2019();if (!compareData2019 && compareData && compareData.itemList) {var requestUrl = Web.Config.Environment.Url.WWW + "Common/Ajax/CompareTranferItem.aspx" + "?CompareItemList=" + api.getCompareString(compareData);$.ajax({type: "GET",url: requestUrl,success: function (data) {if (data) {api.setCompareData2019(data);rebuildItemHtml();}}});}}};var utility = {normalizeCompareString: function (str) {return str.replace(/combo./g, "");},buildCompareString: function (compareData) {if (Biz.Product.CompareConfig2019.PageUrlAlias.compare.indexOf("aspx") !== -1) {var compareString = compareData.storeID + "|";var itemString = '';for (var i = 0; i < compareData.itemList.length - 1; i++) {itemString += compareData.itemList[i] + "^" + compareData.itemList[i] + ",";}itemString += compareData.itemList[compareData.itemList.length - 1] + "^" + compareData.itemList[compareData.itemList.length - 1];return this.normalizeCompareString(compareString + itemString);}else {return this.normalizeCompareString(compareData.itemList.join(","));}},buildCompareListString2019: function (compareData) {if (compareData && compareData.itemList && compareData.itemList.length > 0) {return compareData.itemList.join(",");}},buildCompareSubCateListString2019: function (compareData) {if (compareData && compareData.subCateList && compareData.subCateList.length > 0) {return compareData.subCateList.join(",");}}};var timerhandler;var isShowPopup = false;var showPopup = function () {clearTimeout(timerhandler);if (options.enableCompare2019 === true) {var compareDataFirstSubCateItem = api.getCompareData2019FirstSubCateItem();if (!compareDataFirstSubCateItem || compareDataFirstSubCateItem.length <= 0) {resetInput();return;}}if (!isShowPopup || isShowPopup === false) {rebuildItemHtml();}var popup = $(options.popup);if ($(this).offset().left <= popup.innerWidth()) {popup.removeClass('left').addClass('right');} else {popup.removeClass('right').addClass('left');}$(this).append(popup);if (!options.isSimilarModule) {changePopupPosition.call(this);popup.show();isShowPopup = true;}};var hidePopup = function () {clearTimeout(timerhandler);var popup = $(options.popup);popup.appendTo($(document.body));popup.hide();isShowPopup = false;};var delayHidePopUp = function () {timerhandler = setTimeout(hidePopup, 200);};var goCompare = function () {if (options.enableCompare2019 === true) {var compareDataFirstSubCateItem = api.getCompareData2019FirstSubCateItem();if (!compareDataFirstSubCateItem || compareDataFirstSubCateItem.length <= 0) {return;}}if (options.goCompare) {options.goCompare.call(api);}};var resetInput = function () {if (Biz.Product.CompareConfig2019) {var items = Biz.Product.CompareConfig2019.compareItems;for (var it = 0; it < items.length; it++) {$('input[neg-itemNumber=' + items[it] + ']').prop('checked', false);}}};var getArrowHeight = function (popup, leftStyle, rightStyle, topStyle, bottomStyle) {var arrow = popup.find('.popover-arrow');var leftArrow = parseFloat(arrow.css(leftStyle).match(/(\d)/g)[0]);var rightArrow = parseFloat(arrow.css(rightStyle).match(/(\d)/g)[0]);var topArrow = parseFloat(arrow.css(topStyle).match(/(\d)/g)[0]);var bottomArrow = parseFloat(arrow.css(bottomStyle).match(/(\d)/g)[0]);if (leftArrow !== 0) {return leftArrow;} else if (rightArrow !== 0) {return rightArrow;} else if (topArrow !== 0) {return topArrow;} else if (bottomArrow !== 0) {return bottomArrow;}return 7;};var changePopupPosition = function () {var windowHeight = $(window).height();var documentHeight = $(document).scrollTop();var popup = $(options.popup);var tagHeight;var scrollTop;var topHeight;var bottomHeight;var oldPopupHalfHeight;var fixHeight = 0;var popupPosition = popup.height() / 2 - 10;var arrowPosition = popup.height() / 2;var arrowFixHeight = 0;var arrowHeight = getArrowHeight(popup, 'border-left-width', 'border-right-width', 'border-top-width', 'border-bottom-width');if (!options.isSimilarModule) {tagHeight = $(this).height();scrollTop = $(this).offset().top;topHeight = scrollTop - documentHeight;bottomHeight = windowHeight - (topHeight + tagHeight);oldPopupHalfHeight = (popup.height() - tagHeight) / 2;fixHeight = 0;if (bottomHeight < oldPopupHalfHeight) {fixHeight = oldPopupHalfHeight - bottomHeight + 4;if ($.find('#container').length > 0) {if (topHeight - 2 > scrollTop - $('#container').offset().top) {fixHeight = -oldPopupHalfHeight + scrollTop - $('#container').offset().top - 4;}}} else if (topHeight < oldPopupHalfHeight) {fixHeight = -(oldPopupHalfHeight - topHeight + 2);if ((bottomHeight + fixHeight) < oldPopupHalfHeight) {fixHeight = oldPopupHalfHeight - bottomHeight + 4;}}popupPosition = oldPopupHalfHeight + fixHeight;arrowPosition = arrowPosition + fixHeight;if (topHeight < 0) {arrowFixHeight = arrowHeight;popupPosition = tagHeight / 2 - arrowHeight;popup.find('.popover-arrow').css("top", arrowHeight + "px");} else if (bottomHeight < 0) {arrowFixHeight = - arrowHeight;popupPosition = -(popup.height() - tagHeight / 2 - arrowHeight);popup.find('.popover-arrow').css("top", (popup.height() - arrowHeight) + "px");if ($.find('#container').length > 0) {if (topHeight - 2 > scrollTop - $('#container').offset().top) {arrowFixHeight = scrollTop - $('#container').offset().top + arrowHeight;popupPosition = -(scrollTop - $('#container').offset().top);popup.find('.popover-arrow').css("top", arrowFixHeight + "px");}}} else {popupPosition = -(popupPosition + arrowFixHeight);popup.find('.popover-arrow').css("top", arrowPosition + "px");}popup.css("top", popupPosition + "px");} else {var popverTop = parseFloat($('#similarCompareListPopup').css('top').split('px')[0]);tagHeight = $(this).height();scrollTop = $(this).offset().top;topHeight = scrollTop - documentHeight;bottomHeight = windowHeight - (topHeight + tagHeight);oldPopupHalfHeight = (popup.height() - tagHeight) / 2;fixHeight = 0;if (bottomHeight < oldPopupHalfHeight) {fixHeight = oldPopupHalfHeight - bottomHeight + 4;} else if (topHeight < oldPopupHalfHeight) {fixHeight = -(oldPopupHalfHeight - topHeight + 4);if ((bottomHeight + fixHeight) < oldPopupHalfHeight) {fixHeight = oldPopupHalfHeight - bottomHeight + 4;}}popupPosition = oldPopupHalfHeight + fixHeight;arrowPosition = popup.height() / 2 + fixHeight;if (topHeight < 0) {arrowFixHeight = arrowHeight;popupPosition = popverTop + popup.height() / 2 - arrowHeight;popup.find('.popover-arrow').css("top", arrowHeight + "px");} else if (bottomHeight < 0) {arrowFixHeight = - arrowHeight;popupPosition = popverTop - popup.height() / 2 + arrowHeight;popup.find('.popover-arrow').css("top", (popup.height() - arrowHeight) + "px");} else {popupPosition = popverTop - fixHeight - arrowFixHeight;popup.find('.popover-arrow').css("top", arrowPosition + "px");}popup.css("top", popupPosition + "px");}};var rebuildItemHtml = function () {if (options.enableCompare2019 === true) {cancel();var popupBodyMsg = $(options.popupBodyMsg);if (popupBodyMsg) {popupBodyMsg.remove();}var popupBodyGroup = $(options.compareSubCateGroup);if (popupBodyGroup) {popupBodyGroup.remove();}}resetInput();if (options.enableCompare2019 === true) {var compareData2019 = api.getCompareData2019();var popupBody = $(options.popupBody);var trackingValue = '';if (document.querySelector("#compare_remove_item_tracking") && document.querySelector("#compare_remove_item_tracking").value) {trackingValue = document.querySelector("#compare_remove_item_tracking").value;}if (compareData2019 && compareData2019.length > 0 && popupBody) {for (var ic = 0; ic < compareData2019.length; ic++) {var vc = compareData2019[ic];if (vc && vc.itemsInfo && vc.itemsInfo.itemList) {popupBody.append(addSubCateGroupDom({ subCategoryDescription: vc.subCategoryDescription, subCateItemCount: vc.itemsInfo.itemList.length }));for (var ii = 0; ii < vc.itemsInfo.itemList.length; ii++) {var v = vc.itemsInfo.itemList[ii];if (v) {var popupBodyGroupDom = $(options.compareSubCateGroup);if (popupBodyGroupDom) {$(popupBodyGroupDom[ic]).append(addSubCateItemDom({negIndex: ii,negItemnumber: v,itemProductUrl: vc.itemsInfo.productUrlList[ii],itemImage: vc.itemsInfo.imageList[ii],itemDescription: vc.itemsInfo.descriptionList[ii],tracking: trackingValue}));}$('input[neg-itemNumber=' + v + ']').prop('checked', true);}}}}}}var popup = $(options.popup);$(popup).off("click").on("click", options.removebutton, function (event) {if (event.currentTarget) {deleteItem($(event.currentTarget).attr('neg-itemNumber'));}});};var selectItem = function () {var itemNumber = $(this).attr('neg-itemNumber');cancel();(this && this.checked) ? addItem(this, itemNumber) : deleteItem(itemNumber);};var deleteItem = function (itemNumber) {if (itemNumber) {removeItem(itemNumber);}$('input[neg-itemNumber=' + itemNumber + ']').prop('checked', false);};var removeItem = function (itemNumbers) {removeItemStorage(itemNumbers);if (itemNumbers.indexOf(',') > -1 || Array.isArray(itemNumbers)) {rebuildItemHtml();}else {var $itemCompare = $(options.compareGroup).find('i[neg-itemnumber=' + itemNumbers + ']').parent(".items-compare");var $itemCompareSiblings = $itemCompare.siblings('.items-compare:not([style*="display: none"])');if ($itemCompareSiblings.length > 0) {$itemCompare.css('display', 'none');var $subCategory = $itemCompare.parent('.item-compare-list').find('.items-compare-category strong');if ($subCategory && $subCategory.length === 1) {var descp = $subCategory.text();var kIndex = descp.indexOf('(');$subCategory.text(descp.substr(0, kIndex + 1) + $itemCompareSiblings.length + ')');}} else {$itemCompare.parent('.item-compare-list').css('display', 'none');}var popupBodyMsg = $(options.popupBodyMsg);if (popupBodyMsg.length > 0) {popupBodyMsg.remove();}}if (options.enableCompare2019 === true) {var compareData2019 = api.getCompareData2019();if (!compareData2019 || compareData2019.length <= 0) {hidePopup();}}};var removeSelected = function () {var selectedItems = $(options.compareSubCateGroup).find("div.items-compare input[type='checkbox']:checked");var itemNumbers = [];for (var i = 0; i < selectedItems.length; i++) {itemNumbers.push(selectedItems.eq(i).attr("neg-n-itemNumber"));}if (itemNumbers.length === 0) {return;}removeItem(itemNumbers);};var removeItemStorage = function (itemNumbers) {if (options.enableCompare2019 === true) {if (itemNumbers && !Array.isArray(itemNumbers)) {itemNumbers = itemNumbers.split(',');}var compareData2019 = api.getCompareData2019();if (compareData2019 && compareData2019.length > 0) {$.each(itemNumbers, function (ii, vi) {$.each(compareData2019, function (ic, vc) {if (vc && vc.itemsInfo && vc.itemsInfo.itemList) {var index = $.inArray(vi, vc.itemsInfo.itemList);if (index > -1) {this.itemsInfo.itemList = $.grep(vc.itemsInfo.itemList, function (n) {return n !== vi;});this.itemsInfo.imageList = $.grep(vc.itemsInfo.imageList, function (v, n) {return n !== index;});this.itemsInfo.descriptionList = $.grep(vc.itemsInfo.descriptionList, function (v, n) {return n !== index;});this.itemsInfo.productUrlList = $.grep(vc.itemsInfo.productUrlList, function (v, n) {return n !== index;});}if (this.itemsInfo.itemList.length <= 0) {compareData2019 = $.grep(compareData2019, function (n) {return n.subCategoryId !== vc.subCategoryId;});}if (index > -1) {return false;}}});});compareData2019 = $.grep(compareData2019, function (n) {return n !== null || n !== [];});api.setCompareData2019(compareData2019);}}};var addItem = function (input, itemNumber) {var thumbs = Biz.Product.CompareConfig2019.Thumbs;var currentThumb = null;if (thumbs.length > 0) {$.each(thumbs, function (i, element) {if (element.itemNumber === itemNumber) {currentThumb = element; return false;}});}if (!currentThumb) {if (input) {$(input).attr("checked", false);}return;}if (options.enableCompare2019 === true) {if (!currentThumb.subCategoryId || currentThumb.subCategoryId <= 0) {return;}if (hasItemInCompare2019(currentThumb.itemNumber)) {return;}if (input) {var trackingObj = {};var trackingInfo = $(input).parents('.item-compare-box').find('input#compare_error_msg_tracking').attr('value');if (trackingInfo) {var trackingArray = trackingInfo.split(' ');trackingArray.forEach(function (tracking) {if (!tracking) {return;}var info = tracking.split('=');trackingObj[info[0]] = info[1].replace(/\"/g, '');if (!$(input).attr(info[0])) {return;}$(input).attr(info[0], '');});}}if (dealErrorMsg(input, currentThumb)) {Object.keys(trackingObj).forEach(function (key) {if (trackingObj[key]) {$(input).attr(key, trackingObj[key]);}});return;}var compareData2019 = api.getCompareData2019() || [];if (compareData2019.length > 0) {var hasSameSubCate = false, currentAddSubCate = null;$.each(compareData2019, function (i, v) {if (v) {if (v.subCategoryId === currentThumb.subCategoryId) {hasSameSubCate = true;this.itemsInfo.itemList.unshift(currentThumb.itemNumber);this.itemsInfo.imageList.unshift(currentThumb.imageUrl);this.itemsInfo.descriptionList.unshift(currentThumb.description);this.itemsInfo.productUrlList.unshift(currentThumb.productUrl);currentAddSubCate = this;compareData2019 = $.grep(compareData2019, function (n) {return n.subCategoryId !== v.subCategoryId;});return false;}}});if (compareData2019.length >= 2) {compareData2019.sort(function (a, b) { return a.subCategoryDescription.localeCompare(b.subCategoryDescription); });}if (!hasSameSubCate) {compareData2019 = newCompareData2019(compareData2019, currentThumb);}else {if (currentAddSubCate) {compareData2019.unshift(currentAddSubCate);}}} else {compareData2019 = newCompareData2019(compareData2019, currentThumb);}compareData2019 = $.grep(compareData2019, function (n) {return n !== null || n !== [];});api.setCompareData2019(compareData2019);}rebuildItemHtml();clearTimeout(timerhandler);var popup = $(options.popup);if (!options.isSimilarModule) {if (input) {$(input).parents(options.container).append(popup);if ($(input).parents(options.container).offset().left <= popup.innerWidth()) {popup.removeClass('left').addClass('right');} else {popup.removeClass('right').addClass('left');}}changePopupPosition.call($(input).parents('.item-compare-box'));} else {if (popup.length <= 0 && input) {$(input).trigger("mouseenter");}}popup.show();if (input) {$(input).attr("checked", true);}};var addItemForCompare = function (itemNumber) {var thumbs = Biz.Product.CompareConfig2019.Thumbs;var currentThumb = null;if (thumbs.length > 0) {$.each(thumbs, function (i, element) {if (element.itemNumber === itemNumber) {currentThumb = element; return false;}});}if (!currentThumb) {return;}if (options.enableCompare2019 === true) {if (!currentThumb.subCategoryId || currentThumb.subCategoryId <= 0) {return;}if (hasItemInCompare2019(currentThumb.itemNumber)) {return;}if (dealErrorMsg(undefined, currentThumb)) {return;}var compareData2019 = api.getCompareData2019() || [];if (compareData2019.length > 0) {var hasSameSubCate = false, currentAddSubCate = null;$.each(compareData2019, function (i, v) {if (v) {if (v.subCategoryId === currentThumb.subCategoryId) {hasSameSubCate = true;this.itemsInfo.itemList.unshift(currentThumb.itemNumber);this.itemsInfo.imageList.unshift(currentThumb.imageUrl);this.itemsInfo.descriptionList.unshift(currentThumb.description);this.itemsInfo.productUrlList.unshift(currentThumb.productUrl);currentAddSubCate = this;compareData2019 = $.grep(compareData2019, function (n) {return n.subCategoryId !== v.subCategoryId;});return false;}}});if (!hasSameSubCate) {compareData2019 = newCompareData2019(compareData2019, currentThumb);}else {if (compareData2019.length >= 2) {compareData2019.sort(function (a, b) { return a.subCategoryDescription.localeCompare(b.subCategoryDescription); });}if (currentAddSubCate) {compareData2019.unshift(currentAddSubCate);}}} else {compareData2019 = newCompareData2019(compareData2019, currentThumb);}compareData2019 = $.grep(compareData2019, function (n) {return n !== null || n !== [];});api.setCompareData2019(compareData2019);}};var hasItemInCompare2019 = function (itemNumber) {var compareData2019 = api.getCompareData2019();if (compareData2019 && compareData2019.length > 0) {var hasItem = false;$.each(compareData2019, function (i, v) {if (v && v.itemsInfo && v.itemsInfo.itemList) {if ($.inArray(itemNumber, v.itemsInfo.itemList) > -1) {hasItem = true; return false;}}});return hasItem;}return false;};var newCompareData2019 = function (compareData2019, currentThumb) {compareData2019.unshift({subCategoryId: currentThumb.subCategoryId,subCategoryDescription: currentThumb.subCategoryDescription,recommendsEnabled: true,itemsInfo: {itemList: [currentThumb.itemNumber],imageList: [currentThumb.imageUrl],descriptionList: [currentThumb.description],productUrlList: [currentThumb.productUrl]}});return compareData2019;};var isMaxSubCate = function (currentThumb) {var compareData2019 = api.getCompareData2019();if (compareData2019 && compareData2019.length > 0) {var hasSame = false;$.each(compareData2019, function (i, v) {if (v) {if (v.subCategoryId === currentThumb.subCategoryId) {hasSame = true; return false;}}});if (!hasSame && compareData2019.length >= options.maxSubCategoryGroup) {return true;}}return false;};var isMaxSubCateItem = function (currentThumb) {var compareData2019 = api.getCompareData2019();if (compareData2019 && compareData2019.length > 0) {var isMaxItemLength = false;$.each(compareData2019, function (i, v) {if (v) {if (v.subCategoryId === currentThumb.subCategoryId) {if (v.itemsInfo && v.itemsInfo.itemList) {if ($.inArray(currentThumb.itemNumber, v.itemsInfo.itemList) > -1) {isMaxItemLength = false;} else if (v.itemsInfo.itemList.length >= options.maxSelected) {isMaxItemLength = true;}}return false;}}});return isMaxItemLength;}return false;};var dealErrorMsg = function (input, currentThumb) {var popupBodyMsg = $(options.popupBodyMsg);if (popupBodyMsg.length > 0) {popupBodyMsg.remove();}var popupBody = $(options.popupBody);if (isMaxSubCate(currentThumb)) {if (input) {$(input).attr("checked", false);}if (popupBody) {popupBody.prepend(String.format(parseInt(options.maxSubCategoryGroup) === 1 ? Web.Lang.compareMaxSubCateGroup.replace('groups', 'group') : Web.Lang.compareMaxSubCateGroup, options.maxSubCategoryGroup));}return true;}if (isMaxSubCateItem(currentThumb)) {if (input) {$(input).attr("checked", false);}if (popupBody) {popupBody.prepend(String.format(Web.Lang.compareMaxSubCateItem, options.maxSelected));}return true;}return false;};var addSubCateGroupDom = function (currentThumb) {var template = '<div class="item-compare-list"><div class="items-compare-category"><label class="form-checkbox"><input type="checkbox" neg-n-subCategory=1><span class="form-checkbox-title"></span></label><strong>{subcatedescription} ({subcateitemcount})</strong></div></div>';return template.replace(new RegExp("{subcatedescription}", "gm"), currentThumb.subCategoryDescription).replace(new RegExp("{subcateitemcount}", "gm"), currentThumb.subCateItemCount);};var addSubCateItemDom = function (currentThumb) {var template = '<div class="items-compare"><label class="form-checkbox"><input type="checkbox" neg-n-itemNumber="{negitemnumber}"><span class="form-checkbox-title"></span></label><i class="item-compare-remove fa fa-times" {tracking} neg-index="{negindex}" neg-itemNumber="{negitemnumber}"></i>'+ '<div class="item-compare-img"><a href="{itemproducturl}"><img src="{itemimage}" style="visibility: visible"></a></div><div class="item-compare-desc"><a class="item-title" style="visibility: visible" href="{itemproducturl}">{itemdescription}</a></div></div>';return template.replace(new RegExp("{negindex}", "gm"), currentThumb.negIndex).replace(new RegExp("{negitemnumber}", "gm"), currentThumb.negItemnumber).replace(new RegExp("{itemproducturl}", "gm"), location.origin + currentThumb.itemProductUrl).replace(new RegExp("{itemimage}", "gm"), currentThumb.itemImage).replace(new RegExp("{itemdescription}", "gm"), currentThumb.itemDescription).replace(new RegExp("{tracking}", "gm"), currentThumb.tracking);};var isAllChildrenChecked = function ($container) {return $container.find(".form-checkbox input[type='checkbox']").length === $container.find(".form-checkbox input[type='checkbox']:checked").length;};var hasAnyChildChecked = function ($container) {return $container.find(".form-checkbox input[type='checkbox']:checked").length > 0;};var popBodyClick = function (e) {var target = e.target || e.srcElement;var targetType = target && target.type;if (targetType !== "checkbox") {return;}var $filter = $(target);var isParentNode = $filter.attr('neg-n-subCategory');if (isParentNode) {var $children = $filter.parents('div.items-compare-category').nextAll('div.items-compare');$children.find("label input[type='checkbox']").prop("checked", !!target.checked);} else {var $childNodes = $filter.parents("div.item-compare-list").find('div.items-compare');var $parentNode = $filter.parents("div.item-compare-list").find("div.items-compare-category").first();var $parentTarget = $parentNode.find("input[type='checkbox']");var allChildrenChecked = isAllChildrenChecked($childNodes);var anyChecked = hasAnyChildChecked($childNodes);$parentTarget.prop("checked", allChildrenChecked);$parentTarget.prop("indeterminate", !allChildrenChecked && anyChecked);}};var edit = function () {var popupBodyMsg = $(options.popupBodyMsg);if (popupBodyMsg) {popupBodyMsg.remove();}$(this).closest('.popover-compare').addClass('is-edit');};var cancel = function () {$(options.cancel).closest('.popover-compare').removeClass('is-edit');$(options.compareSubCateGroup + ' input[type="checkbox"]').prop('checked', false);$(options.compareSubCateGroup + ' input[type="checkbox"]').prop('indeterminate', false);};var api = {getCompareData: function () {return storage.getItem(name, null);},setCompareData: function (data) {return storage.setItem(name, data);},getCompareString: function (data) {return utility.buildCompareString(data);},removeItemStorage: removeItemStorage,getCompareData2019: function () {return storage.getItem(name2019, null);},getCompareListString2019: function (data) {return utility.buildCompareListString2019(data);},getSubCateListString2019: function (data) {return utility.buildCompareSubCateListString2019(data);},getCompareData2019FirstSubCate: function () {var compareData2019 = storage.getItem(name2019, null);if (compareData2019 && compareData2019.length > 0) {return compareData2019[0];}},getCompareData2019FirstSubCateIdsAndItemNumbers: function () {var compareData2019 = storage.getItem(name2019, null);if (compareData2019 && compareData2019.length > 0) {var compareData2019FirstSubCate = compareData2019[0];if (compareData2019FirstSubCate && compareData2019FirstSubCate.itemsInfo) {var SubCateList = [];for (var i = 0; i < compareData2019.length; i++) {SubCateList.push(compareData2019[i].subCategoryId);}var resCompareData ={"itemList": compareData2019FirstSubCate.itemsInfo.itemList,"subCateList": SubCateList};return resCompareData;}}},getCompareData2019FirstSubCateItem: function () {var compareData2019 = storage.getItem(name2019, null);if (compareData2019 && compareData2019.length > 0) {var compareData2019FirstSubCate = compareData2019[0];if (compareData2019FirstSubCate && compareData2019FirstSubCate.itemsInfo) {return compareData2019FirstSubCate.itemsInfo.itemList;}}},getCompareData2019SubCateItemBySId: function (subCategoryId) {var compareData2019 = storage.getItem(name2019, null);var allSubcategoryItems = [];if (compareData2019 && compareData2019.length > 0) {for (var ic = 0; ic < compareData2019.length; ic++) {if (compareData2019[ic].subCategoryId === subCategoryId && compareData2019[ic].itemsInfo) {return compareData2019[ic].itemsInfo.itemList;}if (compareData2019[ic].itemsInfo.itemList) {allSubcategoryItems = allSubcategoryItems.concat(compareData2019[ic].itemsInfo.itemList);}}if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && subCategoryId === 0) {return allSubcategoryItems;}}},setCompareData2019: function (data) {return storage.setItem(name2019, data);},addItemForCompare: addItemForCompare,deleteItem: deleteItem,addItem: addItem,editItem: edit,cancel: cancel,remove: removeSelected,goCompare: goCompare,popBodyClick: popBodyClick,rebuildItemHtml: rebuildItemHtml,hidePopup: hidePopup,changePopupPosition: changePopupPosition};init();return api;};return compare;});usingNamespace("Biz.Product")["ComparePage2019"] = {initfirstSubCateTab: function (subCateId) {NEG.run(function (require) {var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);var currentIndex = 0, tempTab = false;if (/*subCateId &&*/ parseInt(subCateId) === -1) {tempTab = true;$currentSubCate.attr("neg-subcate-localstorage", "false");$currentCompareWrap.find('.compare-toolbar .pull-right').remove();}var hasSameSubCate = false, hasSameItems = false;var bizCompare = require("Biz.Product.Compare2019");if (tempTab === false) {var compareData2019 = bizCompare().getCompareData2019();if (compareData2019 && compareData2019.length > 0) {if ($currentSubCate) {compareData2019.sort(function (a, b) { return a.subCategoryDescription.localeCompare(b.subCategoryDescription); });if (/*subCateId &&*/ parseInt(subCateId) >= 0) {for (var ic = 0; ic < compareData2019.length; ic++) {var vc = compareData2019[ic];if (subCateId === vc.subCategoryId) {currentIndex = ic;hasSameSubCate = true;var customerItems = $currentSubCate.attr("neg-subcate-items");if (vc.itemsInfo.itemList && customerItems) {var customerItemList = customerItems.split(',');if (customerItemList.length === vc.itemsInfo.itemList.length) {hasSameItems = true;for (var ii = 0; ii < customerItemList.length; ii++) {if (jQuery.inArray(customerItemList[ii], vc.itemsInfo.itemList) < 0) {hasSameItems = false;}}}}break;}}}}}}if ($currentSubCate) {if (hasSameSubCate && hasSameItems) {$currentSubCate.attr("neg-subcate-localstorage", "true");Biz.Product.ComparePage2019.bindRecommendCheckBox(subCateId);}}});},initSubCateTab: function (subCateId, tabSwitchTracking, tabSwitchTrackingAll) {NEG.run(function (require) {var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);var $currentExpiredMsgWrap = null;var currentIndex = 0, tempTab = false;if (/*subCateId &&*/ parseInt(subCateId) === -1) {tempTab = true;$currentSubCate.attr("neg-subcate-localstorage", "false");$currentCompareWrap.find('.compare-toolbar .pull-right').remove();}var hasSameSubCate = false, hasSameItems = false;var bizCompare = require("Biz.Product.Compare2019");var compareData2019 = [];var isAllComapreItemClear = false;if (/*subCateId &&*/ parseInt(subCateId) === -2) {var hasSameExpiredItemList = false, hasSameExpiredItem = false;var expiredCateID = subCateId, expiredCateDescription = "", expiredCateLink = "";var expiredItemList = $currentSubCate.attr("neg-subcate-items").split(',');var firstItem = expiredItemList[0];$currentExpiredMsgWrap = Biz.Product.ComparePage2019.getExpiredMsgWrap(subCateId);compareData2019 = bizCompare().getCompareData2019();var isFromCompareAllTab = Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && window.location.href.toLowerCase().indexOf("compareall=true") > -1;if (isFromCompareAllTab) {expiredCateID = 0;expiredCateDescription = "All";}if (compareData2019 && compareData2019.length > 0) {if (isFromCompareAllTab) {var expiredItemStringForAll = $currentSubCate.attr("neg-subcate-items");var expiredItemListForAll = expiredItemStringForAll.split(',');var storageItemsForAll = [];for (var iForAll = 0; iForAll < compareData2019.length; iForAll++) {var vForAll = compareData2019[iForAll];if (vForAll.itemsInfo.itemList) {storageItemsForAll = storageItemsForAll.concat(vForAll.itemsInfo.itemList);}}if (expiredItemListForAll.length === storageItemsForAll.length) {hasSameExpiredItemList = true;}for (var ixForAll = 0; ixForAll < expiredItemListForAll.length; ixForAll++) {if (jQuery.inArray(expiredItemListForAll[ixForAll], storageItemsForAll) < 0) {hasSameExpiredItemList = false;} else {hasSameExpiredItem = true;}}}else {for (var i = 0; i < compareData2019.length; i++) {var cd = compareData2019[i];if (cd.itemsInfo.itemList && firstItem) {if (jQuery.inArray(firstItem, cd.itemsInfo.itemList) < 0) {continue;}else {if (cd.itemsInfo.itemList.length === expiredItemList.length) {hasSameExpiredItemList = true;}for (var ei = 0; ei < expiredItemList.length; ei++) {if (jQuery.inArray(expiredItemList[ei], cd.itemsInfo.itemList) < 0) {hasSameExpiredItemList = false;} else {hasSameExpiredItem = true;}}}if (hasSameExpiredItem) {expiredCateID = cd.subCategoryId;expiredCateDescription = cd.subCategoryDescription;break;}}}}}if (hasSameExpiredItem && hasSameExpiredItemList) {if (expiredCateID >= 0) {subCateId = expiredCateID;expiredCateLink = isFromCompareAllTab ? "" :Biz.Product.ComparePage2019.getSubCateLink(expiredCateID, expiredCateDescription);$currentSubCate.find("span").text(expiredCateDescription + " (0)");$currentSubCate.css("display", "");$currentSubCate.attr("neg-subcate-link", expiredCateLink);$currentSubCate.attr("neg-subcate-id", subCateId);$currentSubCate.attr('neg-subcate-descp', expiredCateDescription);$currentSubCate.attr('neg-subcate-localstorage', 'false');$currentExpiredMsgWrap.attr("neg-expiredsubcate-id", subCateId);Biz.Product.ComparePage2019.addBreadCrumb(expiredCateLink, expiredCateDescription);isAllComapreItemClear = isFromCompareAllTab;}} else if ((hasSameExpiredItem && !hasSameExpiredItemList) || isFromCompareAllTab) {if (expiredCateID >= 0 && expiredCateDescription) {expiredCateLink = isFromCompareAllTab ? "" : Biz.Product.ComparePage2019.getSubCateLink(expiredCateID, expiredCateDescription);$currentSubCate.find("span").text(expiredCateDescription + (isFromCompareAllTab?"":" (0)"));$currentSubCate.css("display", "");$currentSubCate.attr("neg-subcate-link", expiredCateLink);Biz.Product.ComparePage2019.addBreadCrumb(expiredCateLink, expiredCateDescription);return;}} else if (!hasSameExpiredItem && !hasSameExpiredItemList) {return;}}if (tempTab === false) {compareData2019 = bizCompare().getCompareData2019();if (compareData2019 && compareData2019.length > 0) {if ($currentSubCate) {compareData2019.sort(function (a, b) { return a.subCategoryDescription.localeCompare(b.subCategoryDescription); });if (/*subCateId &&*/ parseInt(subCateId) > 0) {for (var ic = 0; ic < compareData2019.length; ic++) {var vc = compareData2019[ic];if (subCateId === vc.subCategoryId) {currentIndex = ic;hasSameSubCate = true;var customerItems = $currentSubCate.attr("neg-subcate-items");if (vc.itemsInfo.itemList && customerItems) {var customerItemList = customerItems.split(',');if (customerItemList.length === vc.itemsInfo.itemList.length) {hasSameItems = true;for (var ii = 0; ii < customerItemList.length; ii++) {if (jQuery.inArray(customerItemList[ii], vc.itemsInfo.itemList) < 0) {hasSameItems = false;}}}}break;}}}if (parseInt(subCateId) === 0 && Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true) {var customerItemsForAll = $currentSubCate.attr("neg-subcate-items");var customerItemListForAll = customerItemsForAll.split(',');var storageItems = [];for (var icForAll = 0; icForAll < compareData2019.length; icForAll++) {var vcForAll = compareData2019[icForAll];if (vcForAll.itemsInfo.itemList) {storageItems = storageItems.concat(vcForAll.itemsInfo.itemList);}}if (customerItemListForAll.length === storageItems.length) {currentIndex = 99999;hasSameSubCate = true;hasSameItems = true;for (var iiForAll = 0; iiForAll < customerItemListForAll.length; iiForAll++) {if (jQuery.inArray(customerItemListForAll[iiForAll], storageItems) < 0) {hasSameSubCate = false;hasSameItems = false;}}}}}}}if ($currentSubCate) {Biz.Product.ComparePage2019.initFloatingBoard(subCateId);Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.bindClearAllBtn(subCateId);Biz.Product.ComparePage2019.bindSingleAddOrDeleteBtn(subCateId);if ($currentCompareWrap) {var $currentTable = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');Biz.Product.ComparePage2019.initHighlight($currentTable);}if (hasSameSubCate && hasSameItems) {$currentSubCate.attr("neg-subcate-localstorage", "true");var subcateTemple = '<span class="nav-x-tab-cell" neg-subcate-loaded="false" neg-subcate-id="{0}" neg-subcate-link="{1}" neg-subcate-descp="{2}" neg-subcate-localstorage="true" neg-subcate-active="false"><span {4}>{3}</span></span>';var compareWrapTemple = '<div class="compare-wrap" neg-subcate-id="{0}"><div class="loader"><i class="fa fa-spinner fa-pulse"></i>LOADING...</div></div>';var insertBeforeSubcateAll, insertAfterSubcateAll, insertBeforeWrapContentAll, insertAfterWrapContentAll;var maxSubCate = Biz.Product.ComparePageConfig2019.maxSubCategoryGroup;var totalItemCount = 0;for (var ics = 0; ics < compareData2019.length; ics++) {if (maxSubCate && ics > maxSubCate) {break;}var vcs = compareData2019[ics];totalItemCount += vcs.itemsInfo.itemList ? vcs.itemsInfo.itemList.length : 0;if (subCateId !== vcs.subCategoryId) {var subCateTab = String.format(subcateTemple,vcs.subCategoryId, Biz.Product.ComparePage2019.getSubCateLink(vcs.subCategoryId, vcs.subCategoryDescription), vcs.subCategoryDescription,vcs.subCategoryDescription + (vcs.itemsInfo.itemList ? '&nbsp;(' + (isAllComapreItemClear?0:vcs.itemsInfo.itemList.length) + ')' : ''), tabSwitchTracking);if (ics > currentIndex) {insertAfterSubcateAll += subCateTab;insertAfterWrapContentAll += String.format(compareWrapTemple, vcs.subCategoryId);} else {insertBeforeSubcateAll += subCateTab;insertBeforeWrapContentAll += String.format(compareWrapTemple, vcs.subCategoryId);}}}if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && compareData2019.length > 1 && parseInt(subCateId) > 0) {var compareAllTab = String.format(subcateTemple,0, "", "All", 'All&nbsp;(' + totalItemCount + ')', tabSwitchTrackingAll);insertAfterSubcateAll += compareAllTab;insertAfterWrapContentAll += String.format(compareWrapTemple, 0);}if (insertBeforeSubcateAll) {jQuery(insertBeforeSubcateAll).insertBefore($currentSubCate);}if (insertAfterSubcateAll) {jQuery(insertAfterSubcateAll).insertAfter($currentSubCate);}if (insertBeforeWrapContentAll) {jQuery(insertBeforeWrapContentAll).insertBefore($currentCompareWrap || $currentExpiredMsgWrap);}if (insertAfterWrapContentAll) {jQuery(insertAfterWrapContentAll).insertAfter($currentCompareWrap || $currentExpiredMsgWrap);}Biz.Product.ComparePage2019.bindSwithTab();}else {tempTab = true;$currentSubCate.attr("neg-subcate-localstorage", "false");$currentCompareWrap.find('.compare-toolbar .pull-right').remove();}if (tempTab === true) {var subCateDescription = $currentSubCate.attr('neg-subcate-descp');$currentSubCate.find("span").text(subCateDescription);}jQuery('#AddToWishlist_Content').empty();var wishList = require("Biz.Common.WishList")();wishList.Init();if (hasSameExpiredItem && hasSameExpiredItemList) {Biz.Product.ComparePage2019.setAllItemExpiredUrl();var bizCompareModule = bizCompare();bizCompareModule.removeItemStorage($currentSubCate.attr("neg-subcate-items"));if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && parseInt(subCateId) > 0) {var needChangeCountTab = jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]");var minusCount = $currentSubCate.attr("neg-subcate-items") ? $currentSubCate.attr("neg-subcate-items").split(',').length : 0;if (needChangeCountTab.length > 0 && needChangeCountTab.attr("neg-subcate-loaded")==="false") {var needChangeOriginCount = parseInt(needChangeCountTab.find("span").text().replace(needChangeCountTab.attr('neg-subcate-descp'), "").replace("(", "").replace(")", ""));needChangeCountTab.find("span").text(needChangeCountTab.attr('neg-subcate-descp') + " " + "(" + (needChangeOriginCount - minusCount) + ")");}}}}});jQuery(window).off('scroll').on('scroll', function () {var $this = jQuery(this);var $currentCompareWrap = jQuery(".compare-wrap.is-active");var $table_head = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').find('tr:eq(0)'),$main_table = $table_head.parents('.compare-container'),$wrap = $main_table.closest('.compare-wrap'),_table_top = $main_table.find('tr:gt(0):not([style*="display: none"])').eq(0).offset().top,$items_bar = $currentCompareWrap.find('.compare-items-bar');var _wrap_t = $main_table.offset().top,_wrap_h = $main_table.height(),_bar_h = $items_bar.height();if ($this.scrollTop() >= _wrap_t + _wrap_h - _bar_h) {$items_bar.addClass('at-bottom');} else {$items_bar.removeClass('at-bottom');}var t;if (t) clearTimeout(t);t = setTimeout(function () {if ($this.scrollTop() >= _table_top - 350) {$wrap.find('.compare-items-bar').eq(0).addClass('active');} else {$wrap.find('.compare-items-bar').eq(0).removeClass('active');}}, 50);});},dealCategory: function (subCateId) {NEG.run(function (require) {var bizCompare = require("Biz.Product.Compare2019");var compareData = bizCompare().getCompareData2019();if (compareData && compareData.length > 0) {for (var i = 0; i < compareData.length; i++) {if (compareData[i].subCategoryId.toString() === subCateId) {var $currentCompareWrap = jQuery(".compare-wrap.is-active");var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $firstTr = $table.find("tr").eq(0);if ($firstTr) {var customerItemCount = $firstTr.attr("data-suggests-since");if (customerItemCount && parseInt(customerItemCount)) {var realCustomerItemCount = parseInt(customerItemCount) - 1;if ($table.find('.loader').length > 0) {realCustomerItemCount = parseInt(realCustomerItemCount) - 1;}realCustomerItemCount = realCustomerItemCount > 0 ? realCustomerItemCount : 0;}}var itemnumbers = [];var itemTds = $firstTr.find('.compare-item-col');for (var j = 0; j < realCustomerItemCount; j++) {var pItem = jQuery(itemTds[j]).attr("neg-n-itemnumber");if (pItem) {itemnumbers.push(pItem);}}if (itemnumbers && itemnumbers.length > 0) {for (var k = 0; k < compareData[i].itemsInfo.itemList.length; k++) {var itemNumber = compareData[i].itemsInfo.itemList[k];if (itemnumbers.indexOf(itemNumber) === -1) {bizCompare().removeItemStorage(itemNumber);Biz.Product.ComparePage2019.setCurrentLocationUrl(subCateId, false, itemNumber, null);}}} else {for (var l = 0; l < compareData[i].itemsInfo.itemList.length; l++) {itemNumber = compareData[i].itemsInfo.itemList[l];bizCompare().removeItemStorage(itemNumber);Biz.Product.ComparePage2019.setCurrentLocationUrl(subCateId, false, itemNumber, null);}}}}}});},bindSwithTab: function () {jQuery('.compare-categories').off('click', '.nav-x-tab-cell').on('click', '.nav-x-tab-cell', function () {var $this = jQuery(this);var subCateId = $this.attr("neg-subcate-id");var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);var $currentExpiredMsgWrap = Biz.Product.ComparePage2019.getExpiredMsgWrap(subCateId);if (!$currentCompareWrap && $currentExpiredMsgWrap) {$currentCompareWrap = $currentExpiredMsgWrap;}if ($currentCompareWrap) {$this.addClass('is-active').siblings().removeClass('is-active');jQuery('.compare-wrap').removeClass('is-active');$currentCompareWrap.addClass('is-active');var loaded = $this.attr("neg-subcate-loaded");if (/*subCateId &&*/ parseInt(subCateId) >= 0) {subCateId = parseInt(subCateId);if (loaded === 'false') {$this.attr("neg-subcate-loaded", 'true');NEG.run(function (require) {var bizCompare = require("Biz.Product.Compare2019");var $ = require("NEG.ThirdParty.JQuery");var itemListData = bizCompare().getCompareData2019SubCateItemBySId(subCateId);Biz.Product.ComparePage2019.setCurrentTabNum(subCateId, null, null, itemListData ? itemListData.length : 0);var compareItemListQuery = bizCompare().getCompareListString2019({ itemList: itemListData });if (compareItemListQuery) {var requesturl = Web.Config.Environment.Url.WWW + "Common/Ajax/CompareSubcategoryItem.aspx" + "?CompareItemList=" + encodeURIComponent(compareItemListQuery) + "&SubCategory=" + subCateId + "&_=" + new Date().getTime();if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && subCateId === 0) {requesturl += "&compareall=true";}Biz.Product.ComparePage2019.requestSubCateItems(requesturl);}else {if (jQuery("#phLoadSubTabFail").eq(0)) {var $phLoadSubTabFailTemp = jQuery("#phLoadSubTabFail").eq(0).clone();$currentCompareWrap.html($phLoadSubTabFailTemp.show());}}});}$this.attr("neg-subcate-active", 'true');$this.siblings().attr("neg-subcate-active", 'false');Biz.Product.ComparePage2019.setCurrentLocationUrl(subCateId, null, null, subCateId);}var $liSubCates = jQuery("#baBreadcrumbTop li");if (/*subCateId &&*/ parseInt(subCateId) === -1 || parseInt(subCateId) === 0) {if ($liSubCates && $liSubCates.length > 2) {$liSubCates.eq(1).remove();}} else {var subCateLink = $this.attr('neg-subcate-link');var subCateDescription = $this.attr('neg-subcate-descp');if (subCateLink && subCateDescription) {if ($liSubCates && $liSubCates.length > 0) {var tracking = "";var homeTracking = $liSubCates.eq(0).find("a").attr("onclick");if (homeTracking) {tracking = homeTracking.replace(new RegExp('Home', 'g'), subCateDescription);}if ($liSubCates.length > 2) {$liSubCates.eq(1).attr("onclick", tracking).find("a").attr("href", subCateLink).text(subCateDescription);}else {var newLi = '<li onclick=' + tracking + '><a href="{0}" title="{1}">{1}</a></li>';jQuery(String.format(newLi, subCateLink, subCateDescription)).insertAfter($liSubCates.eq(0));}}}}Biz.Product.ComparePage2019.dealSiteCataLystImpression(subCateId);}});},addBreadCrumb: function (subCateLink, subCateDescription) {var $liSubCates = jQuery("#baBreadcrumbTop li");if (subCateLink && subCateDescription) {if ($liSubCates && $liSubCates.length > 0) {var tracking = "";var homeTracking = $liSubCates.eq(0).find("a").attr("onclick");if (homeTracking) {tracking = homeTracking.replace(new RegExp('Home', 'g'), subCateDescription);}if ($liSubCates.length > 2) {$liSubCates.eq(1).attr("onclick", tracking).find("a").attr("href", subCateLink).text(subCateDescription);}else {var newLi = '<li onclick=' + tracking + '><a href="{0}" title="{1}">{1}</a></li>';jQuery(String.format(newLi, subCateLink, subCateDescription)).insertAfter($liSubCates.eq(0));}}}},requestSubCateItems: function (requesturl) {jQuery.ajax({type: "get",url: requesturl,timeout: 5000,dataType: 'jsonp',jsonp: "action",jsonpCallback: 'Biz.Product.ComparePage2019.dealSubCateItemsResponse',complete: function (event, xhr, options) {if (event.status !== 200) {var subCateId = Biz.Product.ComparePage2019.getSubcateIdFromUrl(this.url);var $currentCompareWrapRemove = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrapRemove) {if (jQuery("#phLoadSubTabTimeOut").eq(0)) {var $phLoadSubTabTimeOutTemp = jQuery("#phLoadSubTabTimeOut").eq(0).clone();$currentCompareWrapRemove.html($phLoadSubTabTimeOutTemp.show());}}}}});},dealSubCateItemsResponse: function (data) {if (data && /*data.SubCateId &&*/ data.ItemCellList) {var subCateId = data.SubCateId;var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(data.SubCateId);if ($currentCompareWrap) {$currentCompareWrap.html(data.ItemCellList).find('.loader').remove();Biz.Product.ComparePage2019.bindRecommendCheckBox(subCateId);Biz.Product.ComparePage2019.bindClearAllBtn(subCateId);Biz.Product.ComparePage2019.bindSingleAddOrDeleteBtn(subCateId);Biz.Product.ComparePage2019.initFloatingBoard(subCateId);Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.initHighlight($currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table'));Biz.Product.ComparePage2019.initRemoveItemTracking(subCateId);var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');if ($table) {var $firstTr = $table.find("tr").eq(0);if ($firstTr) {var customerItemCount = $firstTr.attr("data-suggests-since");if (customerItemCount && parseInt(customerItemCount)) {var realCustomerItemCount = parseInt(customerItemCount) - 1;if ($table.find('.loader').length > 0) {realCustomerItemCount = parseInt(realCustomerItemCount) - 1;}realCustomerItemCount = realCustomerItemCount > 0 ? realCustomerItemCount : 0;Biz.Product.ComparePage2019.setCurrentTabNum(subCateId, null, null, realCustomerItemCount);}}}jQuery('#AddToWishlist_Content').empty();NEG.run(function (require) {var wishList = require("Biz.Common.WishList")();wishList.Init();});}} else if (data /*&& data.SubCateId*/ && data.NoticeMsg) {Biz.Product.ComparePage2019.setCurrentTabNum(data.SubCateId, null, null, 0);var $currentCompareWrapRemove = Biz.Product.ComparePage2019.getMatchCompareWrap(data.SubCateId);if ($currentCompareWrapRemove) {$currentCompareWrapRemove.html(data.NoticeMsg).find('.loader').remove();NEG.run(function (require) {var bizCompareModule = require("Biz.Product.Compare2019");var bizCompare = bizCompareModule();var itemList = bizCompare.getCompareData2019SubCateItemBySId(data.SubCateId).join(",");bizCompare.removeItemStorage(itemList);if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true) {var needChangeCountTab = parseInt(data.SubCateId) > 0 ? jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]") : jQuery(".compare-categories span.nav-x-tab-cell:not([neg-subcate-id=0])");for (var ifc = 0; ifc < needChangeCountTab.length; ifc++) {if (needChangeCountTab.eq(ifc).attr("neg-subcate-loaded") === "false") {if (parseInt(data.SubCateId) > 0) {var minusCount = itemList ? itemList.split(',').length : 0;var needChangeOriginCount = parseInt(needChangeCountTab.eq(ifc).find("span").text().replace(needChangeCountTab.eq(ifc).attr('neg-subcate-descp'), "").replace("(", "").replace(")", ""));needChangeCountTab.eq(ifc).find("span").text(needChangeCountTab.eq(ifc).attr('neg-subcate-descp') + " " + "(" + (needChangeOriginCount - minusCount) + ")");}else {needChangeCountTab.eq(ifc).find("span").text(needChangeCountTab.eq(ifc).attr('neg-subcate-descp') + " " + "(0)");}}}}});Biz.Product.ComparePage2019.setAllItemExpiredUrl();}}},getMatchSubCateTab: function (subCateId) {var $currentTab = jQuery('.compare-categories .nav-x-tab-cell[neg-subcate-id=' + subCateId + ']');if ($currentTab.length > 0) {return $currentTab;}return undefined;},getMatchCompareWrap: function (subCateId) {var $currentWrap = jQuery('.page-section-inner .compare-wrap[neg-subcate-id=' + subCateId + ']');if ($currentWrap.length > 0) {return $currentWrap;}return undefined;},getExpiredMsgWrap: function (subCateId) {var $currentWrap = jQuery('.page-section-inner .compare-wrap[neg-expiredsubcate-id=' + subCateId + ']');if ($currentWrap.length > 0) {return $currentWrap;}return undefined;},formatUrlSEO: function (seo) {if (seo) {seo = seo.replace(new RegExp('&', 'g'), ' ').replace(new RegExp('/', 'g'), ' ').replace(new RegExp('-', 'g'), ' ').replace(new RegExp(',', 'g'), ' ').replace(new RegExp('[.]', 'g'), ' ').replace(new RegExp('[(]', 'g'), ' ').replace(new RegExp('[)]', 'g'), ' ').replace(new RegExp('[+]', 'g'), ' ').trim().replace(new RegExp(' ', 'g'), '-');var len = 0;do {len = seo.length;seo = seo.replace(new RegExp('--', 'g'), '-');}while (len !== seo.length);return seo;}return '';},getSubCateLink: function (subCategoryId, subCategoryDescription) {var subcCateFormatLink = Biz.Product.ComparePageConfig2019.subcategoryLinkFormat;if (subcCateFormatLink) {var subCateKeyWord = Biz.Product.ComparePage2019.formatUrlSEO(subCategoryDescription);return subcCateFormatLink.replace(new RegExp("subcateid", "gm"), subCategoryId).replace(new RegExp("subcatedescription", "gm"), subCateKeyWord);}return '';},initFloatingBoard: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $table_head = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').find('tr:eq(0)'),$main_table = $table_head.parents('.compare-container'),$wrap = $main_table.closest('.compare-wrap'),_table_top = $main_table.find('tr').eq(1).offset().top,$items_bar = jQuery('<div class="compare-items-bar"><div class="compare-container"><table class="compare-table"></table></div></div>');$table_head.clone().appendTo($items_bar.find('.compare-table').eq(0));$wrap.eq(0).prepend($items_bar);$main_table.find('tr').eq(1).attr("neg-table-top", _table_top);if (!$wrap.find('.compare-items-bar .compare-highlight')[0]) {$wrap.find('.compare-items-bar').eq(0).find('.compare-table .compare-th').eq(0).html($wrap.find('div.compare-highlight').eq(0).clone()).append($wrap.find('.compare-print').eq(0).clone());}Biz.Product.ComparePage2019.bindSingleAddOrDeleteBtn(subCateId, true);jQuery(function () {$main_table.off('scroll').on('scroll', function () {var $this = jQuery(this);var $items_bar = $this.closest('.compare-wrap').find('.compare-items-bar');$items_bar.find('.compare-container').scrollLeft(jQuery(this).scrollLeft());});$items_bar.find('.compare-container').off('scroll').on('scroll', function () {var $this = jQuery(this);var $main_table = $this.closest('.compare-wrap').find('.compare-container.scrollbar-winOS-only .compare-item-col').parent().parents('.compare-container');$main_table.scrollLeft(jQuery(this).scrollLeft());});});Biz.Product.ComparePage2019.bindHighLight(subCateId);}},resetFolatingBorad: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $table_head = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').find('tr:eq(0)'),$items_bar = $currentCompareWrap.find('.compare-items-bar');if ($table_head && $items_bar) {$items_bar.find('.compare-table').eq(0).html($table_head.clone());if (!$currentCompareWrap.find('.compare-items-bar .compare-highlight')[0]) {$currentCompareWrap.find('.compare-items-bar').eq(0).find('.compare-table .compare-th').eq(0).html($currentCompareWrap.find('div.compare-highlight').eq(0).clone()).append($currentCompareWrap.find('.compare-print').eq(0).clone());}}}},getRecommendEnableFromLS: function (subCateId) {var resultEnable = true;try {NEG.run(function (require) {if (/*subCateId &&*/ parseInt(subCateId) > 0) {subCateId = parseInt(subCateId);var bizCompare = require("Biz.Product.Compare2019");var compareData2019 = bizCompare().getCompareData2019();if (compareData2019 && compareData2019.length > 0) {jQuery.each(compareData2019, function (i, v) {if (v) {if (v.subCategoryId === subCateId) {resultEnable = v.recommendsEnabled;return false;}}});}}});} catch (e) {return resultEnable;}return resultEnable;},getRecommendEnable: function (subCateId) {var resultEnable = false;if (/*subCateId &&*/ parseInt(subCateId) > 0) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $recomCheck = $currentCompareWrap.find(".compare-toolbar .pull-right input[type=checkbox]");if ($recomCheck && $recomCheck.length === 1) {resultEnable = $recomCheck.prop('checked');}}}return resultEnable;},setRecommendEnable: function (subCateId) {if (/*subCateId &&*/ parseInt(subCateId) > 0) {subCateId = parseInt(subCateId);NEG.run(function (require) {var resultEnable = false;var bizCompare = require("Biz.Product.Compare2019");var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $recomCheck = $currentCompareWrap.find(".compare-toolbar .pull-right input[type=checkbox]");if ($recomCheck && $recomCheck.length === 1) {resultEnable = $recomCheck.prop('checked');}}var compareData2019 = bizCompare().getCompareData2019();if (compareData2019 && compareData2019.length > 0) {for (var i = 0; i < compareData2019.length; i++) {if (compareData2019[i].subCategoryId === subCateId) {compareData2019[i].recommendsEnabled = resultEnable;bizCompare().setCompareData2019(compareData2019);break;}}}});Biz.Product.ComparePage2019.afterSetRecommendEnable(subCateId);}},loadRecommendItems: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var loaded = $currentCompareWrap.attr("neg-subcate-loaded");if (loaded === 'true') {return;}else {$currentCompareWrap.attr("neg-subcate-loaded", 'true');}if (/*subCateId &&*/ parseInt(subCateId) > 0) {var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $firstTr = $table.find("tr").eq(0);var parentItemnumbers = [];var itemTds = $firstTr.find('.compare-item-col');for (var i = 0; i < itemTds.length; i++) {var pItem = jQuery(itemTds[i]).attr("neg-n-parentitem");if (pItem) {parentItemnumbers.push(pItem);}}if ($table && itemTds.length < 5 && $firstTr.find('.loader').length <= 0) {Biz.Product.ComparePage2019.setTableDatasuggestsSince(subCateId, 1);$table.find('tr:eq(0)').append('<td class="compare-item-col"><div class="loader"><i class="fa fa-spinner fa-pulse"></i>LOADING...</div></td>');$table.find('tr:gt(0)').each(function () {jQuery(this).append('<td><span class="compare-td"></span></td>');});Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);}if (parentItemnumbers && parentItemnumbers.length > 0) {var compareItemListQuery = parentItemnumbers.join(",");var requesturl = Web.Config.Environment.Url.WWW + "Common/Ajax/CompareRecommendsItem.aspx" + "?CompareItemList=" + encodeURIComponent(compareItemListQuery) + "&SubCategory=" + subCateId + "&_=" + new Date().getTime();Biz.Product.ComparePage2019.requestRecommendItems(requesturl);}else {var $tableRemoveFloat = $currentCompareWrap.find('.compare-items-bar .compare-table');if ($currentCompareWrap) {if ($table) {if ($table.find('.loader').length > 0) {Biz.Product.ComparePage2019.setTableDatasuggestsSince(subCateId, -1);$table.find('tr td:last-child').remove();if ($tableRemoveFloat.find('.loader').length > 0) {$tableRemoveFloat.find('tr td:last-child').remove();}}}Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);}}}}},requestRecommendItems: function (requesturl) {jQuery.ajax({type: "get",url: requesturl,timeout: 3000,dataType: 'jsonp',jsonp: "action",jsonpCallback: 'Biz.Product.ComparePage2019.dealRecommendItemsResponse',complete: function (event, xhr, options) {if (event.status !== 200) {var subCateId = Biz.Product.ComparePage2019.getSubcateIdFromUrl(this.url);if (/*subCateId &&*/ parseInt(subCateId)) {var subCateIdRemove = subCateId;var $currentCompareWrapRemove = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateIdRemove);var $tableRemove = $currentCompareWrapRemove.find('.compare-container.scrollbar-winOS-only .compare-table');var $tableRemoveFloat = $currentCompareWrapRemove.find('.compare-items-bar .compare-table');if ($currentCompareWrapRemove) {if ($tableRemove) {if ($tableRemove.find('.loader').length > 0) {Biz.Product.ComparePage2019.setTableDatasuggestsSince(subCateIdRemove, -1);$tableRemove.find('tr td:last-child').remove();if ($tableRemoveFloat.find('.loader').length > 0) {$tableRemoveFloat.find('tr td:last-child').remove();}}}Biz.Product.ComparePage2019.calcTableTdWidth(subCateIdRemove);Biz.Product.ComparePage2019.setRecommendsTitleShow(subCateId);}}}}});},getSubcateIdFromUrl: function (url) {var subCateId = null;if (url) {url = url.toLowerCase();var sIndex = url.indexOf('subcategory=');if (sIndex > -1) {var sEnd = url.substr(sIndex, url.length);if (sEnd) {var sSubCategory = sEnd.substr(0, sEnd.indexOf('&'));var subCateIdStr = sSubCategory.replace('subcategory=', '');if (parseInt(subCateIdStr) < 0 || parseInt(subCateIdStr) >= 0) {subCateId = parseInt(subCateIdStr);}}}}return subCateId;},dealRecommendItemsResponse: function (data) {if (data /*&& data.SubCateId*/ && data.ItemCellList) {var subCateId = data.SubCateId;var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $tableFloat = $currentCompareWrap.find('.compare-items-bar .compare-table');if ($table) {if ($table.find('.loader').length > 0) {Biz.Product.ComparePage2019.setTableDatasuggestsSince(subCateId, -1);$table.find('tr td:last-child').remove();if ($tableFloat.find('.loader').length > 0) {$tableFloat.find('tr td:last-child').remove();}}var $insertRows = jQuery("<div><table><tbody></tbody></table></div>").append(data.ItemCellList);var rows = $table.find('tr');var insertRows = $insertRows.find('tr');var totalRecommendCount = insertRows.eq(0).find("td").length;var nowItemCount = rows.eq(0).find("td").length;if (totalRecommendCount && parseInt(totalRecommendCount) && nowItemCount && parseInt(nowItemCount)) {var oneEmptyTd = '<td><span class="compare-td"></span ></td>', emptyEndTd = '', emptyBeginTd = '';for (var iend = 0; iend < totalRecommendCount; iend++) {emptyEndTd = emptyEndTd + oneEmptyTd;}for (var ibegin = 0; ibegin < nowItemCount; ibegin++) {emptyBeginTd = emptyBeginTd + oneEmptyTd;}for (var i = 0; i < rows.length; i++) {var trNow = $table.find('tr:eq(' + i + ')');var rowName = trNow.attr("neg-row-name");if (trNow && rowName) {var trIn = $insertRows.find("tr[neg-row-name='" + rowName + "']");if (trIn && trIn.length === 1) {trNow.append(trIn.find('td'));insertRows = jQuery.grep(insertRows, function (n) {return jQuery(n).attr("neg-row-name") !== rowName;});}else {trNow.append(emptyEndTd);}}}if (insertRows && insertRows.length > 0) {var $lastRow = $table.find('tr:eq(' + (rows.length - 1) + ')');for (var ins = 0; ins < insertRows.length; ins++) {var $trIns = jQuery(insertRows[ins]);jQuery(emptyBeginTd).insertBefore($trIns.find("td:eq(0)"));$trIns.insertBefore($lastRow);}}rows.eq(0).attr("neg-n-recommend", totalRecommendCount);rows.eq(0).attr("neg-n-showedrecom", 5 - nowItemCount);}}Biz.Product.ComparePage2019.resetFolatingBorad(subCateId);$table.find('td:nth-child(n+7)').hide();$tableFloat.find('td:nth-child(n+7)').hide();Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.bindSingleAddOrDeleteBtn(subCateId);Biz.Product.ComparePage2019.initHighlight($currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table'));Biz.Product.ComparePage2019.setRecommendsTitleShow(subCateId);Biz.Product.ComparePage2019.initRemoveItemTracking(subCateId);Biz.Product.ComparePage2019.dealSiteCataLystImpression(subCateId);jQuery('#AddToWishlist_Content').empty();NEG.run(function (require) {var wishList = require("Biz.Common.WishList")();wishList.Init();});}} else if (data /*&& data.SubCateId*/) {var subCateIdRemove = data.SubCateId;var $currentCompareWrapRemove = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateIdRemove);var $tableRemove = $currentCompareWrapRemove.find('.compare-container.scrollbar-winOS-only .compare-table');var $tableRemoveFloat = $currentCompareWrapRemove.find('.compare-items-bar .compare-table');if ($currentCompareWrapRemove) {if ($tableRemove) {if ($tableRemove.find('.loader').length > 0) {Biz.Product.ComparePage2019.setTableDatasuggestsSince(subCateIdRemove, -1);$tableRemove.find('tr td:last-child').remove();if ($tableRemoveFloat.find('.loader').length > 0) {$tableRemoveFloat.find('tr td:last-child').remove();}}}Biz.Product.ComparePage2019.calcTableTdWidth(subCateIdRemove);}}},dealSiteCataLystImpression: function (subCateId) {var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap && $currentSubCate) {var isActiveTab = $currentSubCate.attr("neg-subcate-active");if (isActiveTab === 'false') {return;}var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');if ($table) {var $firstTr = $table.find("tr").eq(0);if ($firstTr) {var customerItemCount = $firstTr.attr("data-suggests-since");if (customerItemCount && parseInt(customerItemCount)) {var realCustomerItemCount = parseInt(customerItemCount) - 1;if ($table.find('.loader').length > 0) {realCustomerItemCount = parseInt(realCustomerItemCount) - 1;}var gtIndex = realCustomerItemCount - 1 > 0 ? realCustomerItemCount - 1 : 0;var $recommendTds = $firstTr.find('td:lt(5):gt(' + gtIndex + ')');if ($recommendTds && $recommendTds.length > 0) {for (var i = 0; i < $recommendTds.length; i++) {var $currentRTd = jQuery($recommendTds[i]);var $currentRTdRemoveI = $currentRTd.find('i.compare-remove');if ($currentRTdRemoveI) {var datasitecatalyst = $currentRTdRemoveI.attr('data-site-catalyst');if (datasitecatalyst && datasitecatalyst !== '') {eval(datasitecatalyst);$currentRTdRemoveI.attr('data-site-catalyst', '');}}}Biz.Common.SiteCatalyst.sendCache("list1", "dynamic recommendation impression");}}}}}},calcTableTdWidth: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $tableFloat = $currentCompareWrap.find('.compare-items-bar .compare-table');var tdLength = $table.find("tr").eq(0).find('td:not([style*="display: none"])').length;if (tdLength && parseInt(tdLength)) {tdLength = /*tdLength > 5 ? 5 :*/ tdLength;var tdWidth = 100 / tdLength + '%';$table.find("tr").each(function () {jQuery(this).find("td").each(function () {jQuery(this).width(0);});for (var i = 0; i < tdLength; i++) {jQuery(this).find("td").eq(i).width(tdWidth);}});$tableFloat.find("tr").each(function () {jQuery(this).find("td").each(function () {jQuery(this).width(0);});for (var i = 0; i < tdLength; i++) {jQuery(this).find("td").eq(i).width(tdWidth);}});}}},setRecommendsTitleShow: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var enabled = Biz.Product.ComparePage2019.getRecommendEnable(subCateId);if (enabled === false) {$currentCompareWrap.find(".compare-toolbar .pull-right .form-toggle .form-cell-name").text(String.format(Web.Lang.compareRecommendations, ''));}else if (enabled === true) {var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $firstTr = $table.find("tr").eq(0);var totalRecommendCount = $firstTr.attr("neg-n-recommend");var showedRecommendCount = $firstTr.attr("neg-n-showedrecom");if (totalRecommendCount && showedRecommendCount) {showedRecommendCount = parseInt(showedRecommendCount) > parseInt(totalRecommendCount) ? totalRecommendCount : showedRecommendCount;}else {showedRecommendCount = 0;totalRecommendCount = 0;}$currentCompareWrap.find(".compare-toolbar .pull-right .form-toggle .form-cell-name").text(String.format(Web.Lang.compareRecommendations, " " + '(' + showedRecommendCount + ' of ' + totalRecommendCount + ')'));}}},afterSetRecommendEnable: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var enabled = Biz.Product.ComparePage2019.getRecommendEnable(subCateId);var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table');var $tableFloat = $currentCompareWrap.find('.compare-items-bar .compare-table');var $firstTr = $table.find("tr").eq(0);if (enabled === true) {if ($firstTr.attr("neg-n-recommend")) {$table.find('td:nth-child(-n+6)').show();$tableFloat.find('td:nth-child(-n+6)').show();Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.initHighlight($currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table'));if (parseInt($firstTr.attr("neg-n-recommend"))) {var maxRecommand = parseInt($firstTr.attr("neg-n-recommend"));maxRecommand = maxRecommand < 0 ? 0 : maxRecommand;var recommandLength = $firstTr.find('td[style*="display: none"]').length;var showedRecom = maxRecommand - recommandLength;showedRecom = showedRecom < 0 ? 0 : showedRecom;$firstTr.attr("neg-n-showedrecom", showedRecom);}}else {Biz.Product.ComparePage2019.loadRecommendItems(subCateId);}Biz.Product.ComparePage2019.setRecommendsTitleShow(subCateId);}else if (enabled === false) {if ($firstTr.attr("neg-n-recommend")) {var customerItemCount = $firstTr.attr("data-suggests-since");if (customerItemCount && parseInt(customerItemCount)) {customerItemCount = parseInt(customerItemCount) + 1;$table.find('td:nth-child(n+' + customerItemCount + ')').hide();$tableFloat.find('td:nth-child(n+' + customerItemCount + ')').hide();Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.initHighlight($currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table'));}}Biz.Product.ComparePage2019.setRecommendsTitleShow(subCateId);}}},bindRecommendCheckBox: function (subCateId) {if (Biz.Product.ComparePageConfig2019 && Biz.Product.ComparePageConfig2019.enableRecommendation === false) {return;}var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $recomCheck = $currentCompareWrap.find(".compare-toolbar .pull-right input[type=checkbox]");if ($recomCheck && $recomCheck.length === 1) {$recomCheck.prop('checked', Biz.Product.ComparePage2019.getRecommendEnableFromLS(subCateId));Biz.Product.ComparePage2019.afterSetRecommendEnable(subCateId);}$currentCompareWrap.find(".compare-toolbar .pull-right").off('click', 'input[type=checkbox]').on('click', 'input[type=checkbox]', function () {var $this = jQuery(this),$parentWrap = $this.parents(".compare-wrap");if ($parentWrap && $parentWrap.length === 1) {var subCateId = $parentWrap.attr("neg-subcate-id");Biz.Product.ComparePage2019.setRecommendEnable(subCateId);}});}},setTableDatasuggestsSince: function (subCateId, Num) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var $table = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table'),$tableFloat = $currentCompareWrap.find('.compare-items-bar .compare-table'),$firstTr = $table.find("tr").eq(0),$firstFloatTr = $tableFloat.find("tr").eq(0);if ($firstTr) {var nowNum = $firstTr.attr("data-suggests-since");if (nowNum && parseInt(nowNum) && Num && parseInt(Num)) {nowNum = parseInt(nowNum);Num = parseInt(Num);$firstTr.attr("data-suggests-since", nowNum + Num);if ($firstFloatTr) {$firstFloatTr.attr("data-suggests-since", nowNum + Num);}}}}},setCurrentTabNum: function (subCateId, Num, itemNumber, resetNum) {if (/*subCateId &&*/ parseInt(subCateId) >= 0) {var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);if ($currentSubCate) {var isTempTab = $currentSubCate.attr("neg-subcate-localstorage");if (isTempTab === 'false') {return;}var subCateDescription = $currentSubCate.attr('neg-subcate-descp');if (resetNum !== null && resetNum !== undefined) {resetNum = parseInt(resetNum) > 0 ? parseInt(resetNum) : 0;$currentSubCate.find("span").text(subCateDescription + " " + "(" + resetNum + ")");return;}if (Num !== null && Num !== undefined) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {nowNum = $currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').find("tr").eq(0).attr("data-suggests-since");if (nowNum && parseInt(nowNum)) {nowNum = parseInt(nowNum) - 1;nowNum = parseInt(nowNum) > 0 ? parseInt(nowNum) : 0;$currentSubCate.find("span").text(subCateDescription + " " + "(" + nowNum + ")");}}}}}},setCurrentLocationUrl: function (subCateId, isAdd, itemNumber, nextsubCateId) {if (/*subCateId &&*/ parseInt(subCateId) >= 0) {var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);if ($currentSubCate) {var isActiveTab = $currentSubCate.attr("neg-subcate-active");if (isActiveTab === 'false') {return;}}}var lowerLink = window.location.href.toLowerCase();var redirectLink = window.location.href;if (lowerLink.indexOf('compareitemlist') > -1) {if (redirectLink.match("[\?]")) {var splValue = window.location.href.split('\?');if (splValue.length > 1) {if (parseInt(nextsubCateId) < 0 || parseInt(nextsubCateId) >= 0) {nextsubCateId = parseInt(nextsubCateId);NEG.run(function (require) {var bizCompare = require("Biz.Product.Compare2019");var compareItemListQuery = bizCompare().getCompareListString2019({ itemList: bizCompare().getCompareData2019SubCateItemBySId(nextsubCateId) });var itemsUrl = compareItemListQuery ? encodeURIComponent(compareItemListQuery) : '';itemsUrl = itemsUrl ? itemsUrl : '';redirectLink = splValue[0] + '?CompareItemList=' + itemsUrl;if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && nextsubCateId === 0) {redirectLink += "&compareall=true";}if (history.replaceState) {history.replaceState(null, null, redirectLink);}return;});return;}var itemnumbers = [], compareQuery = '', OtherQuery = '';var sIndex = splValue[1].toLowerCase().indexOf("compareitemlist");var beforeCList = splValue[1].substr(0, sIndex);var afterCList = splValue[1].substr(sIndex, splValue[1].length);if (afterCList) {var eIndex = afterCList.indexOf('&');if (eIndex > -1) {compareQuery = afterCList.substr(0, eIndex);OtherQuery = beforeCList + afterCList.substr(eIndex, afterCList.length).replace('&', '');}else {compareQuery = afterCList;OtherQuery = beforeCList;}}var parmas = compareQuery.split('=');if (parmas.length > 1) {itemnumbers = decodeURIComponent(parmas[1]).split(',');if (itemnumbers && itemnumbers.length > 0 && itemNumber) {if (isAdd === true) {if (itemnumbers.length < 5) {if (itemnumbers.indexOf(itemNumber) === -1) {itemnumbers.push(itemNumber);}}}else {itemnumbers.remove(itemNumber);}}var itemsUrl = itemnumbers.length > 0 ? encodeURIComponent(itemnumbers.join(",")) : '';itemsUrl = itemsUrl ? itemsUrl : '';redirectLink = splValue[0] + '?CompareItemList=' + itemsUrl + (OtherQuery !== '' ? '&' + OtherQuery : '');if (history.replaceState) {history.replaceState(null, null, redirectLink);}}}}}},setAllItemExpiredUrl: function () {var lowerLink = window.location.href.toLowerCase();var redirectLink = window.location.href;if (lowerLink.indexOf('compareitemlist') > -1 && lowerLink.indexOf('?') > -1) {var urlParams = redirectLink.split('?')[1];var decodeUrlParams = decodeURIComponent(urlParams);var urlParamsArray = decodeUrlParams.split("&");var urlParamsObj = {};urlParamsArray.forEach(function (param) {if (param && param.indexOf("=") > -1) {var paramArr = param.split("=");urlParamsObj[paramArr[0]] = paramArr[1] || "";}});var urlObjArray = [];Object.keys(urlParamsObj).forEach(function (key) {if (key.toLowerCase() === "compareitemlist") {urlParamsObj[key] = "";}urlObjArray.push(key + "=" + encodeURIComponent(urlParamsObj[key]));});if (urlObjArray.length > 0) {var allItemExpiredUrl = redirectLink.split('?')[0] + "?" + urlObjArray.join("&");if (history.replaceState) {history.replaceState(null, null, allItemExpiredUrl);}}}},bindHighLight: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {$currentCompareWrap.off('change', '.compare-highlight select').on('change', '.compare-highlight select', function () {var $this = jQuery(this),_val = $this.children("option").filter(":selected").val(),_text = $this.children("option").filter(":selected").text();var $currentCompareWrapSelect = $this.parents(".compare-wrap");$currentCompareWrapSelect.find('.compare-highlight select').each(function () {jQuery(this).val(_val);jQuery(this).siblings(".form-select-name").text(_text);});$currentCompareWrapSelect.find('.compare-container[data-highlight]').attr('data-highlight', _val);});}},initHighlight: function (currentTable) {if (!currentTable || !currentTable.find("tr")) {currentTable = jQuery("div.compare-wrap.is-active div.scrollbar-winOS-only table.compare-table");}if (currentTable.length > 0) {var isCompareAllTab = currentTable.closest("div.compare-wrap.is-active").attr("neg-subcate-id") === "0";var itemInfos = currentTable.find("tr");jQuery.each(itemInfos, function (index, itemInfo) {if (index === 0) {return;}if (Biz.Product.ComparePage2019.hideEmptyLine(itemInfo, isCompareAllTab)) {return;}jQuery(itemInfo).removeClass("compare-highlight");var displayItemParams = jQuery(itemInfo).find('td:not([style*="display: none"],[style*="width: 0px"])');jQuery.each(displayItemParams, function (index, itemParam) {if (index > 4 && !isCompareAllTab) {return;}if (jQuery(currentTable).find('.loader').length > 0 && index > displayItemParams.length - 2) {return;}jQuery(itemParam).removeClass("compare-item-col");if (displayItemParams.length === 1) {jQuery(itemParam).addClass("compare-item-col");return;}var firstItem = displayItemParams.eq(0);if (firstItem.find("a.item-rating").length > 0) {if (jQuery(itemParam).find("a.item-rating").length === 0) {jQuery(itemInfo).addClass("compare-highlight");return;}var firstItemParam = firstItem.find("a.item-rating").html() ? firstItem.find("a.item-rating").html().trim() : "";var indexItemParam = jQuery(itemParam).find("a.item-rating").html() ? jQuery(itemParam).find("a.item-rating").html().trim() : "";if (firstItemParam !== indexItemParam) {jQuery(itemInfo).addClass("compare-highlight");}return;}else if (firstItem.find("span.compare-td").length > 0) {if (jQuery(itemParam).find("span.compare-td").length === 0) {jQuery(itemInfo).addClass("compare-highlight");return;}var firstItemParam2 = firstItem.find("span.compare-td").html() ? firstItem.find("span.compare-td").html().trim() : "";var indexItemParam2 = jQuery(itemParam).find("span.compare-td").html() ? jQuery(itemParam).find("span.compare-td").html().trim() : "";if (firstItemParam2 !== indexItemParam2) {jQuery(itemInfo).addClass("compare-highlight");}return;}});});}},hideEmptyLine: function (line, isCompareAllTab) {var displayItemParams = jQuery(line).find('td:not([style*="display: none"],[style*="width: 0px"])');var isHideLine = true;jQuery.each(displayItemParams, function (index, itemParam) {if (index > 4 && !isCompareAllTab) {return;}if (jQuery(itemParam).find("span.compare-td").html() !== undefined && jQuery(itemParam).find("span.compare-td").html().trim()) {isHideLine = false;}});jQuery(line).show();if (isHideLine) {jQuery(line).hide();}return isHideLine;},deleteCompareTabCommon: function (injectionSubCateId, injectionpcId) {var subCateId = injectionSubCateId;var pcId = injectionpcId;NEG.run(function (require) {var bizCompareModule = require("Biz.Product.Compare2019");var bizCompare = bizCompareModule();var deletedSubcateItems = bizCompare.getCompareData2019SubCateItemBySId(parseInt(subCateId));Biz.Product.ComparePage2019.deleteCurrentTabStorage(subCateId);if (pcId === "pc2019_rm_back_home") {Biz.Product.ComparePage2019.backHomeCommon(); return;}var tabCount = jQuery(".compare-categories .nav-x-tab-cell").length;if (tabCount && tabCount > 1) {}else {Biz.Product.ComparePage2019.backHomeCommon(); return;}var currentTab = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);if (currentTab) {var isAllTabRemoved = false;if (jQuery(".compare-categories span.nav-x-tab-cell").length <= 3 && jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]").length >= 1) {var allSubTab = Biz.Product.ComparePage2019.getMatchSubCateTab(0);var allSubContent = Biz.Product.ComparePage2019.getMatchCompareWrap(0);allSubTab.remove();allSubContent.remove();isAllTabRemoved = true;}var nextTab = currentTab.next();var firstTab = jQuery(".compare-categories .nav-x-tab-cell").eq(0);var tabContent = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);var tabTitle = currentTab;if (pcId !== "related_delete") {var tabPopup = jQuery(".centerPopup.is-current button.centerPopup-trigger-close");/*current.next('button.centerPopup-trigger-close');*/if (tabPopup) {tabPopup.click();}}if (tabContent) {tabContent.remove();}if (tabTitle) {tabTitle.remove();}if (deletedSubcateItems && !isAllTabRemoved && Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true) {var allOtherTabItemCssSelector = "";for (var deletedSubcateItemIndex = 0; deletedSubcateItemIndex < deletedSubcateItems.length; deletedSubcateItemIndex++) {allOtherTabItemCssSelector += "div.compare-wrap:not(.is-active) > div:not(.compare-items-bar) td.compare-item-col[neg-n-itemnumber=" + deletedSubcateItems[deletedSubcateItemIndex] + "] > i.compare-remove" + (deletedSubcateItemIndex === deletedSubcateItems.length - 1 ? "" : ", ");}var otherTabRemoveButton = jQuery(allOtherTabItemCssSelector);if (otherTabRemoveButton.length >= 1) {otherTabRemoveButton.click();}else if (otherTabRemoveButton.length === 0 && jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]").length >= 1) {var needChangeCountTab = jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]");var needChangeOriginCount = parseInt(needChangeCountTab.find("span").text().replace(needChangeCountTab.attr('neg-subcate-descp'), "").replace("(", "").replace(")", ""));needChangeCountTab.find("span").text(needChangeCountTab.attr('neg-subcate-descp') + " " + "(" + (needChangeOriginCount - deletedSubcateItems.length) + ")");}}switch (pcId) {case "pc2019_rm_stay_here":if (tabCount && tabCount > 1) {Biz.Product.ComparePage2019.stayHereCommon(nextTab, firstTab);}else {Biz.Product.ComparePage2019.backHomeCommon();}break;case "pc2019_rm_back_home":Biz.Product.ComparePage2019.backHomeCommon();break;case "related_delete":if (isAllTabRemoved) {if (tabCount && tabCount > 1) {Biz.Product.ComparePage2019.stayHereCommon(nextTab, firstTab);}else {Biz.Product.ComparePage2019.backHomeCommon();}}break;default:break;}}});},stayHereCommon: function (nextTab, firstTab) {if (nextTab && nextTab.length > 0) {nextTab.click();var nsubCateId = nextTab.attr("neg-subcate-id");Biz.Product.ComparePage2019.setCurrentLocationUrl(null, null, null, nsubCateId);nextTab.attr("neg-subcate-active", 'true');}else if (firstTab && firstTab.length > 0) {firstTab.click();var fsubCateId = firstTab.attr("neg-subcate-id");Biz.Product.ComparePage2019.setCurrentLocationUrl(null, null, null, fsubCateId);firstTab.attr("neg-subcate-active", 'true');}},backHomeCommon: function () {var pc_host = "";var popupTemplate = jQuery("div#Popup_Clear_All_Content");if (popupTemplate) {pc_host = popupTemplate ? popupTemplate.attr("neg-pc2019-home-link") : undefined;pc_host = pc_host ? pc_host.toLowerCase() : "www.newegg.com";}window.location.href = pc_host;},bindClearAllBtn: function (subCateId) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var shownEvent = function (e) {var deleteCompareTab = function (e) {var current = e ? jQuery(e.currentTarget) : undefined;if (current) {var pcId = current.attr('pc-id');pcId = pcId ? pcId.toLowerCase() : undefined;if (pcId) {var subCateId = current.closest("div.message-wrapper").attr("neg-subcate-id");Biz.Product.ComparePage2019.deleteCompareTabCommon(subCateId, pcId);}}};var bindClearPopupBtn = function (btnType, popupId) {btnType = btnType ? btnType.toLowerCase() : "";var btnSelector = "";switch (btnType) {case "rm-back":btnSelector = "[pc-id='PC2019_RM_Back_Home']";break;case "rm-stay":btnSelector = "[pc-id='PC2019_RM_Stay_Here']";break;default:break;}var btn = undefined;if (popupId) {btn = jQuery("#" + popupId + " " + btnSelector);}else {btn = jQuery("div.centerPopup-body " + btnSelector);}if (btn) {btn.off('click', deleteCompareTab).on('click', deleteCompareTab);}};var popupId = jQuery("div#Popup_Clear_All_Content").attr("data-target-id");bindClearPopupBtn("rm-back", popupId);bindClearPopupBtn("rm-stay", popupId);};var clickEvent = function (e) {var getClearPopupStayBtnHtml = function () {var stayBtnHtml = undefined;var totalCount = jQuery(".compare-categories span.nav-x-tab-cell").length;totalCount = totalCount ? totalCount : 0;if (totalCount > 1 && !(Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && jQuery(".compare-categories span.nav-x-tab-cell.is-active").attr("neg-subcate-id") === "0")) {stayBtnHtml = "<button type=\"button\" pc-id=\"PC2019_RM_Stay_Here\" class=\"btn btn-secondary btn-wide\">" + getClearPopupDes("btn-rm-stay") + "</button>";}return stayBtnHtml;};var getClearPopupDes = function (desType) {var des = "";desType = desType ? desType.toLowerCase() : "";var $templateDom = jQuery("#Popup_Clear_All_Content");switch (desType) {case "msg-title":var $thisTitle = jQuery(".compare-categories span.nav-x-tab-cell.is-active");var subCateDescription = $thisTitle.attr('neg-subcate-descp') ? $thisTitle.attr('neg-subcate-descp').toUpperCase() : "";if ($templateDom) {des = $templateDom.attr('neg-pc2019-msg-title');des = des ? des : "";}des = des.replace("{0}", subCateDescription);break;case "btn-rm-back":if ($templateDom) {des = $templateDom.attr('neg-pc2019-btn-rm-back');des = des ? des : "";}break;case "btn-rm-stay":if ($templateDom) {des = $templateDom.attr('neg-pc2019-btn-rm-stay');des = des ? des : "";}break;case "btn-cancel":if ($templateDom) {des = $templateDom.attr('neg-pc2019-btn-cancel');des = des ? des : "";}break;default:break;}return des;};var getClearPopupContainer = function (popupId) {var container = undefined;var bodyIdSelectorRight = "> div.message-info";if (popupId) {container = jQuery("#" + popupId + " > div.centerPopup-body " + bodyIdSelectorRight).eq(0);}else {container = jQuery("#Popup_Clear_All_Content " + bodyIdSelectorRight).eq(0);}return container;};var buildClearPopupBody = function (bodyContainer, popupId, subCateId) {if (bodyContainer) {var bodyHtml = '<div class=\"message-wrapper\" neg-subcate-id=' + subCateId + '>';bodyHtml += "<div class=\"message-icon\"></div>";bodyHtml += "<div class=\"message-information\">";bodyHtml += "<span class=\"message-title\">" + getClearPopupDes("msg-title") + "</span>";bodyHtml += "<div class=\"form-button-area\">";bodyHtml += "<button type=\"button\" pc-id=\"PC2019_RM_Back_Home\" class=\"btn btn-primary btn-wide\">" + getClearPopupDes("btn-rm-back") + "</button>";var stayBtn = getClearPopupStayBtnHtml();if (stayBtn) {bodyHtml += stayBtn;}else {var stayBtnSelector = "[pc-id='PC2019_RM_Stay_Here']";if (popupId) {jQuery("#" + popupId + " " + stayBtnSelector).unbind('click');}else {jQuery("div.centerPopup-body " + stayBtnSelector).unbind('click');}}bodyHtml += "<button type=\"button\" class=\"btn btn-wide centerPopup-trigger-close\">" + getClearPopupDes("btn-cancel") + "</button>";bodyHtml += "</div></div></div>";bodyContainer.html(bodyHtml);}};var $curent = e ? jQuery(e.currentTarget) : undefined;var popupId = jQuery("div#Popup_Clear_All_Content").attr("data-target-id");var subCateId = $curent.closest("div.compare-wrap").attr("neg-subcate-id");var bodyContainer = getClearPopupContainer(popupId);buildClearPopupBody(bodyContainer, popupId, subCateId);};var clearBtnSelector = $currentCompareWrap.find("div.compare-toolbar button[data-source-id='Popup_Clear_All_Content']");var clearBtn = jQuery(clearBtnSelector);if (clearBtn) {clearBtn.addClass("open-popup");}var popupSelector = $currentCompareWrap.find("button.open-popup[data-source-id='Popup_Clear_All_Content']");jQuery(popupSelector).off('click.ng.popup', clickEvent).on('click.ng.popup', clickEvent);jQuery(popupSelector).off('shown.ng.popup', shownEvent).on('shown.ng.popup', shownEvent);}},deleteCurrentTabStorage: function (subCateId) {NEG.run(function (require) {var currentTab = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);var currentLocalstorage = currentTab ? currentTab.attr("neg-subcate-localstorage") : undefined;if (currentTab && currentLocalstorage === 'true') {var customerItems = undefined;if (/*subCateId &&*/ parseInt(subCateId) >= 0) {var bizCompareModule = require("Biz.Product.Compare2019");var bizCompare = bizCompareModule();customerItems = bizCompare.getCompareData2019SubCateItemBySId(parseInt(subCateId));}if (customerItems && customerItems.length > 0) {bizCompare.removeItemStorage(customerItems);}}});},singleAddOrDeleteHandler: function () {var addItemToFirst = function (current) {if (current) {var parent = current.parent("td.compare-item-col");var subCateId = current.closest("div.compare-wrap").attr('neg-subcate-id');var itemNumber = parent ? parent.attr("neg-n-itemnumber") : undefined;if (itemNumber) {NEG.run(function (require) {var bizCompareModule = require("Biz.Product.Compare2019");var bizCompare = bizCompareModule();bizCompare.addItemForCompare(itemNumber);Biz.Product.ComparePage2019.setCurrentTabNum(subCateId, 1, itemNumber);Biz.Product.ComparePage2019.setCurrentLocationUrl(subCateId, true, itemNumber);});var $table = current.closest("div.compare-wrap").find(".compare-container.scrollbar-winOS-only .compare-table");if ($table) {var $currentTd = $table.find("tr:eq(0)").find('td[neg-n-itemnumber=' + itemNumber + ']');var index = $currentTd.index();if ($currentTd) {var $rows = $table.find("tr");for (var i = 0; i < $rows.length; i++) {$currentTd = jQuery($rows[i]).find('td:eq(' + (index - 1) + ')');var $firstTd = jQuery($rows[i]).find('td:eq(0)');if ($currentTd && $firstTd) {$currentTd.insertBefore($firstTd);}}$table.find('td:nth-child(-n+6)').show();}}var $tableFloat = current.closest("div.compare-wrap").find(".compare-items-bar .compare-table");if ($tableFloat) {var currentFloat = $tableFloat.find("tr:eq(0)").find('td[neg-n-itemnumber=' + itemNumber + ']');var firstItemFloat = $tableFloat.find("tr:eq(0)").find('td:eq(0)');if (currentFloat && firstItemFloat) {currentFloat.insertBefore(firstItemFloat);}$tableFloat.find('td:nth-child(-n+6)').show();}Biz.Product.ComparePage2019.initRemoveItemTracking(subCateId);}}};var saveRecommendItem = function (e) {var current = e ? jQuery(e.currentTarget) : undefined;if (current) {$itemIndex = current.closest("td.compare-item-col").index();var subCateId = current.closest("div.compare-wrap").attr('neg-subcate-id');NEG.run(function (require) {var bizCompare = require("Biz.Product.Compare2019");var compareData = bizCompare().getCompareData2019();if (compareData && compareData.length > 0) {for (var i = 0; i < compareData.length; i++) {if (compareData[i].subCategoryId.toString() === subCateId) {if (compareData[i].itemsInfo.itemList.length >= 5) {Biz.Product.ComparePage2019.dealCategory(subCateId);}}}}});if (/*subCateId &&*/ parseInt(subCateId) > 0) {subCateId = parseInt(subCateId);var $table = current.closest("div.compare-wrap").find(".compare-container.scrollbar-winOS-only .compare-table");var $tableFloat = current.closest("div.compare-wrap").find(".compare-items-bar .compare-table");if ($table) {var recommendCounts = $table.find("tr").eq(0).attr("data-suggests-since");recommendCounts = recommendCounts ? parseInt(recommendCounts) : 0;var recommendEnabled = Biz.Product.ComparePage2019.getRecommendEnable(subCateId);if (recommendEnabled && $itemIndex >= recommendCounts) {if (recommendCounts) {recommendCounts += 1;if ($tableFloat) {$tableFloat.find("tr").eq(0).attr("data-suggests-since", recommendCounts);}$table.find("tr").eq(0).attr("data-suggests-since", recommendCounts);}addItemToFirst(current);Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);Biz.Product.ComparePage2019.initAddAllToWishlist();if (Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true) {var needChangeCountTab = jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]");if (needChangeCountTab.length > 0) {var needChangeOriginCount = parseInt(needChangeCountTab.find("span").text().replace(needChangeCountTab.attr('neg-subcate-descp'), "").replace("(", "").replace(")", ""));needChangeCountTab.find("span").text(needChangeCountTab.attr('neg-subcate-descp') + " " + "(" + (needChangeOriginCount + 1) + ")");needChangeCountTab.attr("neg-subcate-loaded", "false");var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(0);if ($currentCompareWrap) {$currentCompareWrap.html('<div class="compare-wrap" neg-subcate-id="0"><div class="loader"><i class="fa fa-spinner fa-pulse"></i>LOADING...</div></div>');}}}}}}}};var deleteItem = function (e) {var current = e ? jQuery(e.currentTarget) : undefined;if (current) {var itemCol = current.closest("td");var itemColIndex = itemCol ? itemCol.index() : undefined;var customerCount = itemCol.parents("tr[data-suggests-since]").attr("data-suggests-since");var $table = current.closest("div.compare-wrap").find(".compare-container.scrollbar-winOS-only .compare-table");if ($table.find('.loader').length > 0) {customerCount = parseInt(customerCount) - 1;}var currentEventSubCateId = current.closest("div.compare-wrap").attr('neg-subcate-id');var isFromOtherEvent = currentEventSubCateId !== jQuery(".compare-categories span.nav-x-tab-cell.is-active").attr("neg-subcate-id");if (customerCount > 2 || itemColIndex > 1) {var itemNumber = itemCol ? itemCol.attr("neg-n-itemnumber") : undefined;if (itemNumber) {NEG.run(function (require) {var bizCompareModule = require("Biz.Product.Compare2019");var bizCompare = bizCompareModule();var relatedSubCateId = 0;if (parseInt(currentEventSubCateId) === 0) {var compareData2019 = bizCompare.getCompareData2019();for (var icForAll = 0; icForAll < compareData2019.length; icForAll++) {var vcForAll = compareData2019[icForAll];if (vcForAll.itemsInfo.itemList) {if (jQuery.inArray(itemNumber, vcForAll.itemsInfo.itemList) !== -1) {relatedSubCateId = vcForAll.subCategoryId;}}}}var $tableFloat = current.closest("div.compare-wrap").find(".compare-items-bar .compare-table");if ($table) {var subCateId = $table.closest("div.compare-wrap").attr('neg-subcate-id');if (itemCol && itemColIndex) {var childPos = itemColIndex + 1;if ($tableFloat) {$tableFloat.find('tr td:nth-child(' + childPos + ')').remove();}$table.find('tr td:nth-child(' + childPos + ')').remove();}subCateId = parseInt(subCateId);var recommendEnabled = Biz.Product.ComparePage2019.getRecommendEnable(subCateId);var recommendCounts = $table.find("tr").eq(0).attr("data-suggests-since");recommendCounts = recommendCounts ? parseInt(recommendCounts) : 0;if (recommendCounts && itemColIndex < recommendCounts) {recommendCounts -= 1;recommendCounts = recommendCounts > 0 ? recommendCounts : 1;if ($tableFloat) {$tableFloat.find("tr").eq(0).attr("data-suggests-since", recommendCounts);}$table.find("tr").eq(0).attr("data-suggests-since", recommendCounts);var $currentSubCate = Biz.Product.ComparePage2019.getMatchSubCateTab(subCateId);if ($currentSubCate && $currentSubCate.attr("neg-subcate-localstorage") === 'true') {bizCompare.removeItemStorage(itemNumber);}Biz.Product.ComparePage2019.setCurrentTabNum(subCateId, -1, itemNumber);Biz.Product.ComparePage2019.setCurrentLocationUrl(subCateId, false, itemNumber);}if (recommendEnabled) {$table.find('td:nth-child(-n+6)').show();$tableFloat.find('td:nth-child(-n+6)').show();var showRecommendCount = $table.find("tr").eq(0).attr("neg-n-showedrecom");var maxRecommendCount = $table.find("tr").eq(0).attr("neg-n-recommend");if (showRecommendCount && parseInt(showRecommendCount) >= 0 && maxRecommendCount && parseInt(maxRecommendCount)) {showRecommendCount = parseInt(showRecommendCount) + 1;maxRecommendCount = parseInt(maxRecommendCount);if (showRecommendCount <= maxRecommendCount) {if ($tableFloat) {$tableFloat.find("tr").eq(0).attr("neg-n-showedrecom", showRecommendCount);}$table.find("tr").eq(0).attr("neg-n-showedrecom", showRecommendCount);}Biz.Product.ComparePage2019.setRecommendsTitleShow(subCateId);Biz.Product.ComparePage2019.dealSiteCataLystImpression(subCateId);}}Biz.Product.ComparePage2019.calcTableTdWidth(subCateId);}Biz.Product.ComparePage2019.initHighlight($table);Biz.Product.ComparePage2019.initAddAllToWishlist();if (!isFromOtherEvent && Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true && itemColIndex < customerCount) {var otherTabRemoveButton = jQuery("div.compare-wrap:not(.is-active) > div:not(.compare-items-bar) td.compare-item-col[neg-n-itemnumber=" + itemNumber + "] > i.compare-remove");if (otherTabRemoveButton.length >= 1) {jQuery("div.compare-wrap:not(.is-active) > div:not(.compare-items-bar) td.compare-item-col[neg-n-itemnumber=" + itemNumber + "] > i.compare-remove").click();}else if (otherTabRemoveButton.length === 0 && jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=0]").length >= 1) {var needChangeCountTab = jQuery(".compare-categories span.nav-x-tab-cell[neg-subcate-id=" + relatedSubCateId + "]:not(.is-active)");if (needChangeCountTab.length > 0) {var needChangeOriginCount = parseInt(needChangeCountTab.find("span").text().replace(needChangeCountTab.attr('neg-subcate-descp'), "").replace("(", "").replace(")", ""));if (needChangeOriginCount <= 1) {Biz.Product.ComparePage2019.deleteCompareTabCommon(relatedSubCateId, "related_delete");}else {needChangeCountTab.find("span").text(needChangeCountTab.attr('neg-subcate-descp') + " " + "(" + (needChangeOriginCount - 1) + ")");}}}}});}}else if (isFromOtherEvent && Biz.Product.ComparePageConfig2019.isShowCompareAllTab === true){if (parseInt(currentEventSubCateId) !== 0) {Biz.Product.ComparePage2019.deleteCompareTabCommon(currentEventSubCateId, "related_delete");}}else{var subCateId = current.closest("div.compare-wrap").attr('neg-subcate-id');var currentWarp = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);currentWarp.find('.compare-toolbar button.btn[data-source-id="Popup_Clear_All_Content"]').click();}}};var handler = {saveRecommendItem: saveRecommendItem,deleteItem: deleteItem};return handler;},bindSingleAddOrDeleteBtn: function (subCateId, isFloatingButton) {var $currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);var handler = Biz.Product.ComparePage2019.singleAddOrDeleteHandler();if ($currentCompareWrap) {if (!isFloatingButton) {$currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').off('click', '.compare-save').on('click', '.compare-save', handler.saveRecommendItem);$currentCompareWrap.find('.compare-container.scrollbar-winOS-only .compare-table').off('click', '.compare-remove').on('click', '.compare-remove', handler.deleteItem);}else {$currentCompareWrap.find('.compare-items-bar .compare-container .compare-table').off('click', '.compare-save').on('click', '.compare-save', handler.saveRecommendItem);$currentCompareWrap.find('.compare-items-bar .compare-container .compare-table').off('click', '.compare-remove').on('click', '.compare-remove', handler.deleteItem);}}},initAddAllToWishlist: function () {jQuery.each(jQuery("div.compare-wrap"), function (index, wrap) {var compareTable = jQuery(wrap).find("div.scrollbar-winOS-only table.compare-table");var userItemsCount = compareTable.find("tr[data-suggests-since]").attr("data-suggests-since");var itemCells = compareTable.find("tr").eq(0);var itemNumberList = jQuery.map(itemCells.find("td"), function (itemcell, index) {if (index < userItemsCount - 1) {return jQuery(itemcell).attr("neg-n-itemnumber");}});jQuery(wrap).find("[name='AddAllToWishlist']").data("itemnumberlist", itemNumberList);jQuery(wrap).find("[name='AddAllToWishlist']").data("wishlistbackinfo", "noitemdetail");});},initRemoveItemTracking: function (subCateId) {var $currentCompareWrap;$currentCompareWrap = Biz.Product.ComparePage2019.getMatchCompareWrap(subCateId);if ($currentCompareWrap) {var currentTable = $currentCompareWrap.find("div.scrollbar-winOS-only table.compare-table");var userItemsCount = currentTable.find("tr[data-suggests-since]").attr("data-suggests-since");var itemCells = currentTable.find("tr").eq(0);jQuery.each(itemCells.find("td"), function (index, itemcell) {var removeIcon = jQuery(itemcell).find("i#removeCompareItem");var trackingMsg = jQuery(removeIcon).attr("neg-n-trackinginfo");if (trackingMsg) {if (index < userItemsCount - 1) {trackingMsg = String.format(trackingMsg, "RemoveSelectedItem".toLowerCase());} else {trackingMsg = String.format(trackingMsg, "RemoveRecomItem".toLowerCase());}var trackingInfo = Biz.Product.ComparePage2019.buildTrackingInfo(trackingMsg);if (trackingInfo) {Object.keys(trackingInfo).forEach(function (key) {if (trackingInfo[key]) {jQuery(removeIcon).attr(key, trackingInfo[key]);}});}}});var currentTableFloat = $currentCompareWrap.find(".compare-items-bar .compare-table");var userItemsCountFloat = currentTableFloat.find("tr[data-suggests-since]").attr("data-suggests-since");var itemCellsFloat = currentTableFloat.find("tr").eq(0);jQuery.each(itemCellsFloat.find("td"), function (index, itemcell) {var removeIcon = jQuery(itemcell).find("i#removeCompareItem");var trackingMsg = jQuery(removeIcon).attr("neg-n-trackinginfo");if (trackingMsg) {if (index < userItemsCountFloat - 1) {trackingMsg = String.format(trackingMsg, "RemoveSelectedItem".toLowerCase());} else {trackingMsg = String.format(trackingMsg, "RemoveRecomItem".toLowerCase());}var trackingInfo = Biz.Product.ComparePage2019.buildTrackingInfo(trackingMsg);if (trackingInfo) {Object.keys(trackingInfo).forEach(function (key) {if (trackingInfo[key]) {jQuery(removeIcon).attr(key, trackingInfo[key]);}});}}});}},initRecommendTracking: function () {var currentRecomCheckbox = jQuery("div.compare-wrap.is-active .compare-toolbar .pull-right input[type='checkbox']");jQuery(currentRecomCheckbox).on("click", function (e) {var $target = e.target || e.srcElement;var isChecked = jQuery($target).prop("checked");var trackingMsg = jQuery($target).attr("neg-n-trackinginfo");if (trackingMsg) {if (isChecked) {trackingMsg = String.format(trackingMsg, "on");} else {trackingMsg = String.format(trackingMsg, "off");}var trackingInfo = Biz.Product.ComparePage2019.buildTrackingInfo(trackingMsg);if (trackingInfo) {Object.keys(trackingInfo).forEach(function (key) {if (trackingInfo[key]) {jQuery($target).attr(key, trackingInfo[key]);}});}}});},buildTrackingInfo: function (trackingMsg) {if (!trackingMsg) {return null;}var trackingInfo = {};try {trackingMsg.split(" ").forEach(function (info) {if (!info) {return;}var infoArr = info.split("=");trackingInfo[infoArr[0]] = infoArr[1].replace(/"/g, "");});} catch (e) {return null;}return trackingInfo;}};