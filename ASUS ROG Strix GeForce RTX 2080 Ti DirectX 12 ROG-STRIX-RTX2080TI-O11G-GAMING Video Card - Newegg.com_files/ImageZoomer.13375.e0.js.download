NEG.Module("NEG.Widget.ImageZoomer",function(j){var i=j("NEG.ThirdParty.jQuery"),q=j("NEG.Widget.Mask"),o={magnifierDom:"<div>",detailImgProperty:"imgZoomPic",fixPosition:!0,magnifierBackgroundImg:base.baseURL+"NEG/Resource/Widget/ImageZoomer/tile.gif",getRealImgSize:!1,detailWindowStyle:{}},p=function(a,g){var b=i(a.target);g.fixPosition&&"static"==b.css("position")&&b.css("position","relative");var e=new function(){var b,e=NEG.utility.isDefined(a.detailWindow);b=e?{target:a.detailWindow}:{size:a.getDetailSize(),
position:a.getDetailPosition()};var c=NEG.merge(g.detailWindowStyle,{"background-color":"white",opacity:"1",overflow:"hidden","z-index":2E4}),f=q(b,{style:c,hideWhenClick:!1});if(!e)f.on("BEFORE_SHOW",function(){var d=a.getDetailSize(),c=a.getDetailPosition();NEG.utility.isDefined(d.width)&&NEG.utility.isDefined(d.height)&&f.setSize(d);NEG.utility.isDefined(c.top)&&NEG.utility.isDefined(c.left)&&f.setPosition(c)});var d=i("<div style='position: absolute'>");a.boxSize&&a.boxSize.width&&a.boxSize.height&&
d.width(a.boxSize.width).height(a.boxSize.height);i(f.dom).append(d);this.setImg=function(c){var f=function(a,c){var d=i("<img>");d.attr("src",a);d.css(c);return d},b=function(a,c){var d;c.children("img").each(function(c,f){var b=i(f);b.attr("src")==a&&(d=b)});return d}(c,d);b||(b=f(c,a.imgSize),d.append(b));d.children("img").hide();b.show()};this.setImgPosition=function(a){d.css({left:a.left,top:a.top})};this.show=function(){f.show();d.show()};this.getSize=function(){return e?f.getSize():a.getDetailSize()};
this.hide=function(){d.hide();f.hide()}},h=new function(){var e=null,h=null,c=null,f={width:0,height:0},e=i(g.magnifierDom);e.css({position:"absolute",cursor:"pointer",background:"url("+g.magnifierBackgroundImg+")"});this.show=function(){c=e.appendTo(b)};this.setSize=function(a){f=a;e.css(a)};this.hide=function(){c&&c.remove()};this.setPosition=function(c){var b=a.target.getBoundingClientRect(),g=Math.min(Math.max(0,c.left-b.left-f.width/2),a.target.clientWidth-f.width),c=Math.min(Math.max(0,c.top-
b.top-f.height/2),a.target.clientHeight-f.height);h={left:g,top:c};e.css(h)};this.getCurrentPos=function(){return h}},k,l,m,n,j=function(){var i=function(c,f,d){c=a.imgSize;return{left:-d.left/f.clientWidth*c.width,top:-d.top/f.clientHeight*c.height}},j=function(){var c=a.imgSize,f=e.getSize(),d=jQuery(this).width(),b=jQuery(this).height(),c=Math.max(c.width/d,c.height/b);return{width:Math.round(Math.min(d,f.width/c)),height:Math.round(Math.min(b,f.height/c))}};l||(l=function(a){var b=window?1<window.devicePixelRatio:
!1,d=jQuery(this).attr(g.detailImgProperty),d=b?d+(-1<d.indexOf("?")?"&":"?")+"ex=2":d;e.setImg(d);b=j.apply(this);h.setSize(b);a={left:a.clientX,top:a.clientY};h.setPosition(a);b=h.getCurrentPos();e.setImgPosition(i(a,this,b));h.show();e.show()});m||(m=function(a){a={left:a.clientX,top:a.clientY};h.setPosition(a);var b=h.getCurrentPos();e.setImgPosition(i(a,this,b))});n||(n=function(){e.hide();h.hide()});k||(k=function(){b.off("mouseenter",l);b.off("mousemove",m);b.off("mouseleave",n)});k();b.on("mouseenter",
l);b.on("mousemove",m);b.on("mouseleave",n)};this.start=function(){j()};this.stop=function(){k&&k()}};return function(a,g){var b;if(a&&g&&g.detailWindow&&NEG.utility.isDefined(a.length)&&0<a.length)for(b=0;b<a.length;b++)(new p({target:a[b],imgSize:{width:1280,height:960},detailWindow:g.detailWindow[0]},o)).start();else{var e;a:{if(NEG.utility.isDefined(a.target)&&NEG.utility.isDefined(a.imgSize)&&NEG.utility.isType(a.imgSize.width,"Number")&&NEG.utility.isType(a.imgSize.height,"Number")){if(NEG.utility.isDefined(a.detailWindow)){e=
!0;break a}if(NEG.utility.isDefined(a.getDetailPosition)&&NEG.utility.isType(a.getDetailPosition,"Function")&&NEG.utility.isDefined(a.getDetailSize)&&NEG.utility.isType(a.getDetailSize,"Function")){e=a.getDetailPosition();var h=a.getDetailSize();e=NEG.utility.isType(e.top,"Number")&&NEG.utility.isType(e.left,"Number")&&NEG.utility.isType(h.width,"Number")&&NEG.utility.isType(h.height,"Number");break a}}e=!1}e&&!a.target.length&&(g||(g={}),NEG.blend(g,o,{cover:!1,mergePrototype:!1}),b=new p(a,g));
return b}}});
